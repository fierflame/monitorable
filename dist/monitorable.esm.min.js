/*!
 * monitorable v0.1.0-beta.2
 * (c) 2020-2021 Fierflame
 * @license MIT
 */
let e,t;function n(t){"function"!=typeof e?console.error(t):e(t)}function r(t){e="function"==typeof t?t:void 0}function o(e){return Boolean(e&&["object","function"].includes(typeof e))}function f(e){return(...t)=>{try{e(...t)}catch(e){n(e)}}}function u(e){try{e()}catch(e){n(e)}}function i(e,t){if(e&&("function"==typeof e||"object"==typeof e))return"number"==typeof t?[e,String(t)]:"symbol"==typeof t||"string"==typeof t||"boolean"==typeof t?[e,t]:void 0}function c(e,t,n){if(e.has(t))return e.get(t);const r=n();return e.set(t,r),r}function l(e,n){if(!t)return;const r=i(e,n);if(!r)return;[e,n]=r;const o=c(t,e,()=>new Map);o.has(n)||o.set(n,!1)}function s(e,n,r){const o=t;t=e;try{return(null==r?void 0:r.postpone)?g(n,"priority"===r.postpone):n()}finally{t=o}}function a(e,t,n){if("function"==typeof t)return s(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return s(e,n,t)}const p=new WeakMap;function y(e,t,n){var r;const o=null===(r=p.get(e))||void 0===r?void 0:r.get(t);if(!o)return;let f=[...o];n&&(f=f.filter(([,e])=>n(e))),f.forEach(([e])=>e())}let d;function v(e,n){const r=!n&&d||new Map,o=d;d=r;try{return e()}finally{d=o,r!==d&&function(e){for(const[r,o]of e.entries()){var n;const e=null===(n=t)||void 0===n?void 0:n.get(r);for(const t of o)y(r,t,e=>!e),(null==e?void 0:e.has(t))&&e.set(t,!0)}}(r)}}function g(e,t){if("function"==typeof e)return v(e,t);if("function"!=typeof t)throw new Error("fn needs to be a function");return v(t,e)}function b(e,t){const n=i(e,t);n&&([e,t]=n,!function(e,t){return!!d&&(c(d,e,()=>new Set).add(t),!0)}(e,t)?y(e,t):y(e,t,Boolean))}function R(e,t,n,r=!1){if("function"!=typeof n)return()=>{};const o=i(e,t);if(!o)return()=>{};[e,t]=o;const u=t;let l=p.get(e);l||(l=new Map,p.set(e,l));const s=c(l,u,()=>new Set),a=[f(n),r];s.add(a);let y=!1;return()=>{y||(y=!0,s.delete(a),s.size||l&&(l.delete(u),l.size||p.delete(e)))}}function h(e,t,n){let r;e=f(e);const o=null==n?void 0:n.postpone;let u=!1;function i(){if(u)return!1;if(u=!0,!r)return!0;const e=r;return r=void 0,e.forEach(e=>e()),!0}function c(){i()&&e(!0)}function l(){i()&&e(!1)}const s=new Map,p=a(s,()=>t(l),{postpone:o});return function(t){if(u)return!1;if(!t.size)return u=!0,e(!1);const o=[];for(let[n,r]of t)for(const[t,f]of r){if(f)return e(!0);o.push([n,t])}r=o.map(([e,t])=>R(e,t,c,null==n?void 0:n.disdeferable))}(s),(null==n?void 0:n.resultOnly)?p:{result:p,stop:l}}function _(e,t,n){if("function"!=typeof e)throw new Error("cb needs to be a function");if("function"==typeof t)return h(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return h(e,n,t)}function P(e,t,n){let r;function o(){if(!r)return!1;const e=r;return r=void 0,e.forEach(e=>e()),!0}function u(){o()&&e(!0)}function i(...f){o();const i=new Map,c=a(i,()=>t(...f),n);return function(t){if(!t.size)return e(!1);const o=[];for(let[n,r]of t)for(const[t,f]of r){if(f)return e(!0);o.push([n,t])}r=o.map(([e,t])=>R(e,t,u,null==n?void 0:n.disdeferable))}(i),c}return e=f(e),i.stop=()=>{o()&&e(!1)},i}function m(e,t,n){if("function"==typeof t)return P(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return P(e,n,t)}function w(e){return Boolean("function"==typeof e&&e.__$$__monitorable_value__$$__)}function O(){const e=this();return null==e?e:e.valueOf()}function S(...e){const t=this();return null==t?String(t):"function"==typeof t.toString?t.toString(...e):String(t)}function E(e){const t=this();return null==t?String(t):"function"==typeof t[Symbol.toPrimitive]?t[Symbol.toPrimitive](e):"string"===e?String(t):"number"===e?Number(t):t}function j(e,t,n=(()=>{}),r=(()=>{})){function o(e,n=!1){if(t)try{t(e,()=>{n=!0})}finally{n&&a()}}function f(){return l(i,"value"),e()}const i=(...e)=>e.length?(o(e[0],e[1]),e[0]):f();Reflect.defineProperty(i,"value",{get:f,set:o,enumerable:!0,configurable:!0}),Reflect.defineProperty(i,"valueOf",{value:O,enumerable:!0,configurable:!0}),Reflect.defineProperty(i,"toString",{value:S,enumerable:!0,configurable:!0}),Reflect.defineProperty(i,Symbol.toPrimitive,{value:E,enumerable:!0,configurable:!0});let c=new Set;function s(e,t){if(!c)return()=>{};const n=R(i,"value",()=>e(i,!1),t);let o=!1;const f=()=>{o||(o=!0,c&&c.delete(f),n(),u(()=>e(i,!0)))};return c.add(f),r(),()=>{o||(o=!0,c&&c.delete(f),n(),r())}}Reflect.defineProperty(i,"watch",{get:()=>s,set(){},configurable:!0});const a=()=>b(i,"value");a.has=()=>{var e;return Boolean(null===(e=c)||void 0===e?void 0:e.size)},a.stop=()=>{if(!c)return;const e=c;c=void 0;for(const t of[...e])t()},Reflect.defineProperty(i,"__$$__monitorable_value__$$__",{value:!0,configurable:!0});let p=!1;return i.stop=()=>{p||(p=!0,n(),a.stop())},{value:i,trigger:a}}function $(e){let t,n;const{value:r}=j(()=>n,(e,r)=>{e!==t&&(t=e,n=t,r())});return r(e),r}function M(e,t,n){var r,o;"function"!=typeof t&&(n=t,t=void 0);const f=t,u=null===(r=n)||void 0===r?void 0:r.postpone,i=null===(o=n)||void 0===o?void 0:o.deferable;let c,l,s,a=!1,p=!1;const y=m(e=>{p=!e,e&&s&&s()},e,{postpone:u,disdeferable:!i});function d(){p=!0;try{return c=y(),l=c,l}catch(e){throw a||(p=!1),e}}let v;return({value:v,trigger:s}=j(()=>p||a?l:d(),f&&(e=>f(e)),()=>{a||(a=!0,p||d())})),v}function x(e,t,n,r){function o(e,t){r&&r(e,t)}return M(()=>{const r=e[t];return void 0===r&&n?n():w(r)?r():r},r=>{const f=e[t];if(w(f))return f(r),void o(r,!0);void 0===f&&n&&n(r),o(r,!1)})}function z(e,t,n,r){if(!t)return(t,n,r)=>x(e,t,n,r);if(!Array.isArray(t))return x(e,t,n,r);const o=Object.create(null);for(const o of t){const t=x(e,o,n&&n(o),r&&((e,t)=>r(e,t,o)));Reflect.defineProperty(e,o,{get:()=>t(),set(e){t.value=e},configurable:!0,enumerable:!0})}return o}function A(e,t=Reflect.ownKeys(e),n){const r=Object.create(e);function o(e,t){n&&n(e,t)}const f=Array.isArray(t)?t:Reflect.ownKeys(t),u=Array.isArray(t)?e:t;for(const e of f){const t=u[e];w(t)&&Reflect.defineProperty(r,e,{get:()=>t(),set(n){t.value=n,o(n,e)},configurable:!0,enumerable:!0})}return r}function B(e,t){return M(()=>{const n=e[t];return w(n)?n():n},n=>{const r=e[t];w(r)?r(n):e[t]=n})}function K(e,t){return arguments.length>=2?B(e,t):t=>B(e,t)}function V(e){let t,n=!1;return(r,o)=>{if(o)return e(r,o);const f=r();f===t&&n||(n=!0,t=f,e(r,o))}}function k(e,t,n){return Reflect.defineProperty(e,t,{get:()=>(l(e,t),n),set(r){r!==n&&(n=r,b(e,t))},configurable:!0,enumerable:!0})}function D(e,t={},n){const r=n||null===t?Object.create(t):t;for(const t of e){let e=r[t];Reflect.defineProperty(r,t,{get:()=>(l(r,t),e),set(n){n!==e&&(e=n,b(r,t))},configurable:!0,enumerable:!0})}return r}function C(e,t){return l(e,t),e[t]}function q(e,t,n){return n===e[t]||(e[t]=n,b(e,t)),n}function I(e){return Boolean(e&&["object","function"].includes(typeof e))}let N;function W(e,t=0){if(!I(e))return e;const n=F(e),r=!0===t?1/0:t||0,o=new Proxy(n,{set(e,n,r,o){if(!1===t)return Reflect.set(e,n,r,o);const f=Reflect.has(e,n),u=Reflect.get(e,n,o),i=Reflect.set(e,n,r,W(o));return i?(f!==Reflect.has(e,n)&&b(o,!0),u!==Reflect.get(e,n,o)&&b(o,n),i):i},get(e,f,u){if(N===o&&"__monitorable__recover__"===f)return void(N=n);if(!1===t)return Reflect.get(e,f,u);l(u,f);const i=Reflect.get(e,f,W(u));return r>0?W(i,r-1):i},setPrototypeOf(e,n){if(!1===t)return Reflect.setPrototypeOf(e,n);const r=Reflect.getPrototypeOf(e),f=Reflect.setPrototypeOf(e,n);return f&&r!==n&&(b(e,!1),b(o,!1)),f},getPrototypeOf(e){if(!1===t)return Reflect.getPrototypeOf(e);l(e,!1),l(o,!1);const n=Reflect.getPrototypeOf(e);return r>0?W(n,r-1):n},defineProperty(e,n,r){if(!1===t)return Reflect.defineProperty(e,n,r);let f=!0;if("value"in r){const t=Reflect.getOwnPropertyDescriptor(e,n);t&&"value"in t&&F(r.value)===F(t.value)&&(f=!1)}const u=Reflect.defineProperty(e,n,r);return f&&u&&(b(e,n),b(o,n)),u},getOwnPropertyDescriptor:(e,n)=>(!1===t||(l(e,n),l(o,n)),Reflect.getOwnPropertyDescriptor(e,n)),deleteProperty(e,n){if(!1===t)return Reflect.deleteProperty(e,n);const r=Reflect.has(e,n),f=Reflect.deleteProperty(e,n);return r&&!Reflect.has(e,n)&&(b(e,n),b(e,!0),b(o,n),b(o,!0)),f},ownKeys:e=>(!1===t||(l(e,!0),l(o,!0)),Reflect.ownKeys(e)),has:(e,n)=>(!1===t||(l(e,!0),l(o,!0)),Reflect.has(e,n))});return o}function F(e){if(!e)return e;if(!I(e))return e;let t=e;try{N=e,t=e.__monitorable__recover__}catch(e){}return t=N,N=!1,t&&("object"==typeof t||"function"==typeof t)?t:e}function G(e,t){return F(e)===F(t)}var H=Object.freeze({__proto__:null,printError:n,setPrintError:r,encashable:o,safeify:f,safeCall:u,getIndexes:i,getMapValue:c,markRead:l,observe:a,postpone:g,markChange:b,watchProp:R,exec:_,monitor:m,isValue:w,value:$,computed:M,valueify:z,mixValue:A,asValue:K,merge:V,defineProperty:k,createObject:D,get:C,set:q,encase:W,recover:F,equal:G});export default H;export{K as asValue,M as computed,D as createObject,k as defineProperty,W as encase,o as encashable,G as equal,_ as exec,C as get,i as getIndexes,c as getMapValue,w as isValue,b as markChange,l as markRead,V as merge,A as mixValue,m as monitor,a as observe,g as postpone,n as printError,F as recover,u as safeCall,f as safeify,q as set,r as setPrintError,$ as value,z as valueify,R as watchProp};
//# sourceMappingURL=monitorable.esm.min.js.map
