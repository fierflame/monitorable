/*!
 * monitorable v0.1.0-alpha.5
 * (c) 2020 Fierflame
 * @license MIT
 */
let t,e;function n(e,n=!1){n||"function"!=typeof e&&void 0!==e?"function"!=typeof t?console.error(e):t(e):t=e}function o(t){return Boolean(t&&["object","function"].includes(typeof t))}function r(t){return(...e)=>{try{t(...e)}catch(t){n(t,!0)}}}function f(t,e){if(t&&("function"==typeof t||"object"==typeof t))return"number"==typeof e?[t,String(e)]:"symbol"==typeof e||"string"==typeof e||"boolean"==typeof e?[t,e]:void 0}function c(t,e,n){if(t.has(e))return t.get(e);const o=n();return t.set(e,o),o}function u(t,n){if(!e)return;const o=f(t,n);o&&([t,n]=o,c(e,t,()=>new Set).add(n))}function i(t,n,o){const r=e;e=n;try{return(null==o?void 0:o.postpone)?y(t,"priority"===o.postpone):t()}finally{e=r}}const l=new WeakMap;function s(t,e){var n;const o=null===(n=l.get(t))||void 0===n?void 0:n.get(e);o&&[...o].forEach(t=>t())}let p,a;function y(t,e){const n=!e&&p||new Map,o=p;p=n;try{return t()}finally{p=o,n!==p&&function(t){for(const[e,n]of t.entries())for(const t of n)s(e,t)}(n)}}function d(t,e){const n=f(t,e);n&&([t,e]=n,function(t,e){return!!p&&(c(p,t,()=>new Set).add(e),!0)}(t,e)||s(t,e))}function v(t,e,n){if("function"!=typeof n)return()=>{};const o=f(t,e);if(!o)return()=>{};[t,e]=o;const u=e;let i=l.get(t);i||(i=new Map,l.set(t,i));const s=c(i,u,()=>new Set);n=r(n),s.add(n);let p=!1;return()=>{p||(p=!0,s.delete(n),s.size||i&&(i.delete(u),i.size||l.delete(t)))}}function g(t){return Boolean(t&&["object","function"].includes(typeof t))}function R(t,e=0){if(!g(t))return t;const n=h(t),o=!0===e?1/0:e||0,r=new Proxy(n,{set(t,n,o,r){if(!1===e)return Reflect.set(t,n,o,r);const f=Reflect.has(t,n),c=Reflect.set(t,n,o,R(r));return c?(f!==Reflect.has(t,n)&&d(t,!0),c):c},get(t,f,c){if(a===r&&"__monitorable__recover__"===f)return void(a=n);if(!1===e)return Reflect.get(t,f,c);u(t,f);const i=Reflect.get(t,f,R(c));return o>0?R(i,o-1):i},setPrototypeOf(t,n){if(!1===e)return Reflect.setPrototypeOf(t,n);const o=Reflect.getPrototypeOf(t),r=Reflect.setPrototypeOf(t,n);return r&&o!==n&&d(t,!1),r},getPrototypeOf(t){if(!1===e)return Reflect.getPrototypeOf(t);u(t,!1);const n=Reflect.getPrototypeOf(t);return o>0?R(n,o-1):n},defineProperty(t,n,o){if(!1===e)return Reflect.defineProperty(t,n,o);let r=!0;if("value"in o){const e=Reflect.getOwnPropertyDescriptor(t,n);e&&"value"in e&&h(o.value)===h(e.value)&&(r=!1)}const f=Reflect.defineProperty(t,n,o);return r&&f&&d(t,n),f},getOwnPropertyDescriptor:(t,n)=>(!1===e||u(t,n),Reflect.getOwnPropertyDescriptor(t,n)),deleteProperty(t,n){if(!1===e)return Reflect.deleteProperty(t,n);const o=Reflect.has(t,n),r=Reflect.deleteProperty(t,n);return o&&!Reflect.has(t,n)&&(d(t,n),d(t,!0)),r},ownKeys:t=>(!1===e||u(t,!0),Reflect.ownKeys(t)),has:(t,n)=>(!1===e||u(t,!0),Reflect.has(t,n))});return r}function h(t){if(!t)return t;if(!g(t))return t;let e=t;try{a=t,e=t.__monitorable__recover__}catch(t){}return e=a,a=!1,e&&("object"==typeof e||"function"==typeof e)?e:t}function w(t,e){return h(t)===h(e)}function P(t,e,n){let o;e=r(e);const f=!0===n||"object"==typeof n&&(null==n?void 0:n.resultOnly),c="object"==typeof n&&(null==n?void 0:n.postpone);function u(){if(!o)return!1;const t=o;return o=void 0,t.forEach(t=>t()),!0}function l(){u()&&e(!0)}const s=new Map,p=i(t,s,{postpone:c});if(!s.size)return e(!1),f?p:{result:p,stop(){}};o=[];for(let[t,e]of s)for(const n of e)o.push(v(h(t),n,l));return f?p:{result:p,stop(){u()&&e(!1)}}}function b(t,e,n){let o;function f(){if(!o)return!1;const t=o;return o=void 0,t.forEach(t=>t()),!0}function c(){f()&&e(!0)}function u(){f();const r=new Map;try{return i(t,r,n)}catch(t){throw r.clear(),t}finally{if(r.size){o=[];for(let[t,e]of r)for(const n of e)o.push(v(h(t),n,c))}else e(!1)}}return e=r(e),u.stop=()=>{f()&&e(!1)},u}const O=new WeakSet;function _(t){return O.has(t)}function j(t,e,n=(()=>{}),o=(()=>{})){function f(t,n=!1){if(e)try{e(t,()=>{n=!0})}finally{n&&p()}}function c(){return u(i,"value"),t()}const i=(...t)=>t.length?(f(t[0],t[1]),t[0]):c();function l(t){if(!s)return()=>{};t=r(t),s.push(t),o();let e=!1;return()=>{if(e)return;if(e=!0,!s)return;const n=s.findIndex(e=>e===t);n<0||(s.splice(n,1),o())}}Reflect.defineProperty(i,"value",{get:c,set:f,enumerable:!0,configurable:!0});let s=[];Reflect.defineProperty(i,"watch",{get:()=>l,set(){},configurable:!0});const p=()=>{if(s){d(i,"value");for(const t of[...s])t(i,!1)}};p.has=()=>{var t;return Boolean(null===(t=s)||void 0===t?void 0:t.length)},p.stop=()=>{if(!s)return;const t=s;s=void 0;for(const e of[...t])e(i,!0)},O.add(i);let a=!1;return i.stop=()=>{a||(a=!0,n(),p.stop())},{value:i,trigger:p}}function m(t,e){const n=!0===e||e&&e.proxy;let o,r;const{value:f}=j(()=>r,(t,e)=>{n&&(t=h(t)),t!==o&&(o=t,r=n?R(o):o,e())});return f(t),f}function x(t,e,n){var o;"function"!=typeof e&&(n=e,e=void 0);const r=e,f=!0===n||n&&n.proxy,c="object"==typeof n&&(null===(o=n)||void 0===o?void 0:o.postpone);let u,i,l,s=!1,p=!1;const a=b(t,t=>{p=!t,t&&l&&l()},{postpone:c});function y(){p=!0;try{return u=a(),f&&(u=h(u)),i=f?R(u):u,i}catch(t){throw s||(p=!1),t}}let d;return({value:d,trigger:l}=j(()=>p||s?i:y(),r&&(t=>r(f?h(t):t)),()=>{s||(s=!0,p||y())})),d}function M(t){let e,n=!1;return(o,r)=>{if(r)return t(o,r);const f=h(o());f===e&&n||(n=!0,e=f,t(o,r))}}function S(t){for(const e of Reflect.ownKeys(t)){const n=Reflect.getOwnPropertyDescriptor(t,e);if(!n)continue;if(!("value"in n)||"get"in n||"set"in n)continue;const o=n.value;_(o)&&(n.get=()=>o.value,n.writable&&(n.set=t=>o.value=t),delete n.value,delete n.writable,Reflect.defineProperty(t,e,n))}return t}export{x as computed,b as createExecutable,R as encase,o as encashable,w as equal,P as exec,f as getIndexes,c as getMapValue,_ as isValue,d as markChange,u as markRead,M as merge,S as mix,i as observe,y as postpone,n as printError,h as recover,r as safeify,m as value,v as watchProp};
//# sourceMappingURL=monitorable.esm.min.js.map
