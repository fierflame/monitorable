/*!
 * monitorable v0.1.0-beta.0
 * (c) 2020 Fierflame
 * @license MIT
 */
let t,e;function n(e){"function"!=typeof t?console.error(e):t(e)}function o(e){t="function"==typeof e?e:void 0}function r(t){return Boolean(t&&["object","function"].includes(typeof t))}function f(t){return(...e)=>{try{t(...e)}catch(t){n(t)}}}function i(t,e){if(t&&("function"==typeof t||"object"==typeof t))return"number"==typeof e?[t,String(e)]:"symbol"==typeof e||"string"==typeof e||"boolean"==typeof e?[t,e]:void 0}function u(t,e,n){if(t.has(e))return t.get(e);const o=n();return t.set(e,o),o}function c(t,n){if(!e)return;const o=i(t,n);if(!o)return;[t,n]=o;const r=u(e,t,()=>new Map);r.has(n)||r.set(n,!1)}function l(t,n,o){const r=e;e=t;try{return(null==o?void 0:o.postpone)?g(n,"priority"===o.postpone):n()}finally{e=r}}function s(t,e,n){if("function"==typeof e)return l(t,e,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return l(t,n,e)}const p=new WeakMap;function a(t,e){var n;const o=null===(n=p.get(t))||void 0===n?void 0:n.get(e);o&&[...o].forEach(t=>t())}let y,d;function v(t,n){const o=!n&&y||new Map,r=y;y=o;try{return t()}finally{y=r,o!==y&&function(t){for(const[o,r]of t.entries()){var n;const t=null===(n=e)||void 0===n?void 0:n.get(o);for(const e of r)a(o,e),(null==t?void 0:t.has(e))&&t.set(e,!0)}}(o)}}function g(t,e){if("function"==typeof t)return v(t,e);if("function"!=typeof e)throw new Error("fn needs to be a function");return v(e,t)}function h(t,e){const n=i(t,e);n&&([t,e]=n,function(t,e){return!!y&&(u(y,t,()=>new Set).add(e),!0)}(t,e)||a(t,e))}function b(t,e,n){if("function"!=typeof n)return()=>{};const o=i(t,e);if(!o)return()=>{};[t,e]=o;const r=e;let c=p.get(t);c||(c=new Map,p.set(t,c));const l=u(c,r,()=>new Set);n=f(n),l.add(n);let s=!1;return()=>{s||(s=!0,l.delete(n),l.size||c&&(c.delete(r),c.size||p.delete(t)))}}function w(t){return Boolean(t&&["object","function"].includes(typeof t))}function R(t,e=0){if(!w(t))return t;const n=P(t),o=!0===e?1/0:e||0,r=new Proxy(n,{set(t,n,o,r){if(!1===e)return Reflect.set(t,n,o,r);const f=Reflect.has(t,n),i=Reflect.set(t,n,o,R(r));return i?(f!==Reflect.has(t,n)&&h(t,!0),i):i},get(t,f,i){if(d===r&&"__monitorable__recover__"===f)return void(d=n);if(!1===e)return Reflect.get(t,f,i);c(t,f);const u=Reflect.get(t,f,R(i));return o>0?R(u,o-1):u},setPrototypeOf(t,n){if(!1===e)return Reflect.setPrototypeOf(t,n);const o=Reflect.getPrototypeOf(t),r=Reflect.setPrototypeOf(t,n);return r&&o!==n&&h(t,!1),r},getPrototypeOf(t){if(!1===e)return Reflect.getPrototypeOf(t);c(t,!1);const n=Reflect.getPrototypeOf(t);return o>0?R(n,o-1):n},defineProperty(t,n,o){if(!1===e)return Reflect.defineProperty(t,n,o);let r=!0;if("value"in o){const e=Reflect.getOwnPropertyDescriptor(t,n);e&&"value"in e&&P(o.value)===P(e.value)&&(r=!1)}const f=Reflect.defineProperty(t,n,o);return r&&f&&h(t,n),f},getOwnPropertyDescriptor:(t,n)=>(!1===e||c(t,n),Reflect.getOwnPropertyDescriptor(t,n)),deleteProperty(t,n){if(!1===e)return Reflect.deleteProperty(t,n);const o=Reflect.has(t,n),r=Reflect.deleteProperty(t,n);return o&&!Reflect.has(t,n)&&(h(t,n),h(t,!0)),r},ownKeys:t=>(!1===e||c(t,!0),Reflect.ownKeys(t)),has:(t,n)=>(!1===e||c(t,!0),Reflect.has(t,n))});return r}function P(t){if(!t)return t;if(!w(t))return t;let e=t;try{d=t,e=t.__monitorable__recover__}catch(t){}return e=d,d=!1,e&&("object"==typeof e||"function"==typeof e)?e:t}function m(t,e){return P(t)===P(e)}function O(t,e,n){let o;t=f(t);const r=null==n?void 0:n.postpone;let i=!1;function u(){if(i)return!1;if(i=!0,!o)return!0;const t=o;return o=void 0,t.forEach(t=>t()),!0}function c(){u()&&t(!0)}function l(){u()&&t(!1)}const p=new Map,a=s(p,()=>e(l),{postpone:r});return function(e){if(i)return!1;if(!e.size)return i=!0,t(!1);const n=[];for(let[o,r]of e)for(const[e,f]of r){if(f)return t(!0);n.push([o,e])}o=n.map(([t,e])=>b(P(t),e,c))}(p),(null==n?void 0:n.resultOnly)?a:{result:a,stop:l}}function S(t,e,n){if("function"!=typeof t)throw new Error("cb needs to be a function");if("function"==typeof e)return O(t,e,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return O(t,n,e)}function _(t,e,n){let o;function r(){if(!o)return!1;const t=o;return o=void 0,t.forEach(t=>t()),!0}function i(){r()&&t(!0)}function u(...f){r();const u=new Map,c=s(u,()=>e(...f),n);return function(e){if(!e.size)return t(!1);const n=[];for(let[o,r]of e)for(const[e,f]of r){if(f)return t(!0);n.push([o,e])}o=n.map(([t,e])=>b(P(t),e,i))}(u),c}return t=f(t),u.stop=()=>{r()&&t(!1)},u}function E(t,e,n){if("function"==typeof e)return _(t,e,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return _(t,n,e)}const M=new WeakSet;function j(t){return M.has(t)}function x(){const t=this();return null==t?t:t.valueOf()}function z(...t){const e=this();return null==e?String(e):"function"==typeof e.toString?e.toString(...t):String(e)}function D(t){const e=this();return null==e?String(e):"function"==typeof e[Symbol.toPrimitive]?e[Symbol.toPrimitive](t):"string"===t?String(e):"number"===t?Number(e):e}function B(t,e,n=(()=>{}),o=(()=>{})){function r(t,n=!1){if(e)try{e(t,()=>{n=!0})}finally{n&&p()}}function i(){return c(u,"value"),t()}const u=(...t)=>t.length?(r(t[0],t[1]),t[0]):i();function l(t){if(!s)return()=>{};t=f(t),s.push(t),o();let e=!1;return()=>{if(e)return;if(e=!0,!s)return;const n=s.findIndex(e=>e===t);n<0||(s.splice(n,1),o())}}Reflect.defineProperty(u,"value",{get:i,set:r,enumerable:!0,configurable:!0}),Reflect.defineProperty(u,"valueOf",{value:x,enumerable:!0,configurable:!0}),Reflect.defineProperty(u,"toString",{value:z,enumerable:!0,configurable:!0}),Reflect.defineProperty(u,Symbol.toPrimitive,{value:D,enumerable:!0,configurable:!0});let s=[];Reflect.defineProperty(u,"watch",{get:()=>l,set(){},configurable:!0});const p=()=>{if(s){h(u,"value");for(const t of[...s])t(u,!1)}};p.has=()=>{var t;return Boolean(null===(t=s)||void 0===t?void 0:t.length)},p.stop=()=>{if(!s)return;const t=s;s=void 0;for(const e of[...t])e(u,!0)},M.add(u);let a=!1;return u.stop=()=>{a||(a=!0,n(),p.stop())},{value:u,trigger:p}}function K(t,e){const n=!0===e||e&&e.proxy;let o,r;const{value:f}=B(()=>r,(t,e)=>{n&&(t=P(t)),t!==o&&(o=t,r=n?R(o):o,e())});return f(t),f}function k(t,e,n){var o;"function"!=typeof e&&(n=e,e=void 0);const r=e,f=!0===n||n&&n.proxy,i="object"==typeof n&&(null===(o=n)||void 0===o?void 0:o.postpone);let u,c,l,s=!1,p=!1;const a=E(t=>{p=!t,t&&l&&l()},t,{postpone:i});function y(){p=!0;try{return u=a(),f&&(u=P(u)),c=f?R(u):u,c}catch(t){throw s||(p=!1),t}}let d;return({value:d,trigger:l}=B(()=>p||s?c:y(),r&&(t=>r(f?P(t):t)),()=>{s||(s=!0,p||y())})),d}function W(t){let e,n=!1;return(o,r)=>{if(r)return t(o,r);const f=P(o());f===e&&n||(n=!0,e=f,t(o,r))}}function I(t){for(const e of Reflect.ownKeys(t)){const n=Reflect.getOwnPropertyDescriptor(t,e);if(!n)continue;if(!("value"in n)||"get"in n||"set"in n)continue;const o=n.value;j(o)&&(n.get=()=>o.value,n.writable&&(n.set=t=>o.value=t),delete n.value,delete n.writable,Reflect.defineProperty(t,e,n))}return t}function N(t,e,n=K(void 0),o){function r(t,e){o&&o(t,e)}return k(()=>{if(!(e in t))return n();const o=t[e];return j(o)?o():o},o=>{if(!(e in t))return n(o),void r(o,!1);const f=t[e];if(j(f))return f(o),void r(o,!0);r(o,!1)})}function q(t,e,n,o){return arguments.length>=2?N(t,e,n,o):(e,n,o)=>N(t,e,n,o)}function A(t,e){return k(()=>{const n=t[e];return j(n)?n():n},n=>{const o=t[e];j(o)?o(n):t[e]=n})}function C(t,e){return arguments.length>=2?A(t,e):e=>A(t,e)}export{C as asValue,k as computed,R as encase,r as encashable,m as equal,S as exec,i as getIndexes,u as getMapValue,j as isValue,h as markChange,c as markRead,W as merge,I as mix,E as monitor,s as observe,l as observeRun,g as postpone,n as printError,P as recover,f as safeify,o as setPrintError,K as value,q as valueify,b as watchProp};
//# sourceMappingURL=monitorable.esm.min.js.map
