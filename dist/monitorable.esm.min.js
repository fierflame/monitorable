/*!
 * monitorable v0.1.0-alpha.4
 * (c) 2020 Fierflame
 * @license MIT
 */
let e,t;function n(t,n=!1){n||"function"!=typeof t&&void 0!==t?"function"!=typeof e?console.error(t):e(t):e=t}function r(e){return Boolean(e&&["object","function"].includes(typeof e))}function o(e){return(...t)=>{try{e(...t)}catch(e){n(e,!0)}}}function f(e,t){if(e&&("function"==typeof e||"object"==typeof e))return"number"==typeof t?[e,String(t)]:"symbol"==typeof t||"string"==typeof t||"boolean"==typeof t?[e,t]:void 0}function c(e,t,n){if(e.has(t))return e.get(t);const r=n();return e.set(t,r),r}function u(e,n){if(!t)return;const r=f(e,n);r&&([e,n]=r,c(t,e,()=>new Set).add(n))}function i(e,n){const r=t;t=n;try{return e()}finally{t=r}}const l=new WeakMap;function s(e,t){var n;const r=null===(n=l.get(e))||void 0===n?void 0:n.get(t);r&&[...r].forEach(e=>e())}let a,p;function y(e,t){const n=!t&&a||new Map,r=a;a=n;try{return e()}finally{a=r,n!==a&&function(e){for(const[t,n]of e.entries())for(const e of n)s(t,e)}(n)}}function d(e,t){const n=f(e,t);n&&([e,t]=n,function(e,t){return!!a&&(c(a,e,()=>new Set).add(t),!0)}(e,t)||s(e,t))}function v(e,t,n){if("function"!=typeof n)return()=>{};const r=f(e,t);if(!r)return()=>{};[e,t]=r;const u=t;let i=l.get(e);i||(i=new Map,l.set(e,i));const s=c(i,u,()=>new Set);n=o(n),s.add(n);let a=!1;return()=>{a||(a=!0,s.delete(n),s.size||i&&(i.delete(u),i.size||l.delete(e)))}}function g(e){return Boolean(e&&["object","function"].includes(typeof e))}function R(e,t=0){if(!g(e))return e;const n=h(e),r=!0===t?1/0:t||0,o=new Proxy(n,{set(e,n,r,o){if(!1===t)return Reflect.set(e,n,r,o);const f=Reflect.has(e,n),c=Reflect.set(e,n,r,R(o));return c?(f!==Reflect.has(e,n)&&d(e,!0),c):c},get(e,f,c){if(p===o&&"__monitorable__recover__"===f)return void(p=n);if(!1===t)return Reflect.get(e,f,c);u(e,f);const i=Reflect.get(e,f,R(c));return r>0?R(i,r-1):i},setPrototypeOf(e,n){if(!1===t)return Reflect.setPrototypeOf(e,n);const r=Reflect.getPrototypeOf(e),o=Reflect.setPrototypeOf(e,n);return o&&r!==n&&d(e,!1),o},getPrototypeOf(e){if(!1===t)return Reflect.getPrototypeOf(e);u(e,!1);const n=Reflect.getPrototypeOf(e);return r>0?R(n,r-1):n},defineProperty(e,n,r){if(!1===t)return Reflect.defineProperty(e,n,r);let o=!0;if("value"in r){const t=Reflect.getOwnPropertyDescriptor(e,n);t&&"value"in t&&h(r.value)===h(t.value)&&(o=!1)}const f=Reflect.defineProperty(e,n,r);return o&&f&&d(e,n),f},getOwnPropertyDescriptor:(e,n)=>(!1===t||u(e,n),Reflect.getOwnPropertyDescriptor(e,n)),deleteProperty(e,n){if(!1===t)return Reflect.deleteProperty(e,n);const r=Reflect.has(e,n),o=Reflect.deleteProperty(e,n);return r&&!Reflect.has(e,n)&&(d(e,n),d(e,!0)),o},ownKeys:e=>(!1===t||u(e,!0),Reflect.ownKeys(e)),has:(e,n)=>(!1===t||u(e,!0),Reflect.has(e,n))});return o}function h(e){if(!e)return e;if(!g(e))return e;let t=e;try{p=e,t=e.__monitorable__recover__}catch(e){}return t=p,p=!1,t&&("object"==typeof t||"function"==typeof t)?t:e}function w(e,t){return h(e)===h(t)}function P(e,t,n){let r;function f(){if(!r)return!1;const e=r;return r=void 0,e.forEach(e=>e()),!0}function c(){f()&&t(!0)}t=o(t);const u=new Map,l=i(e,u);if(!u.size)return t(!1),n?l:{result:l,stop(){}};r=[];for(let[e,t]of u)for(const n of t)r.push(v(h(e),n,c));return n?l:{result:l,stop(){f()&&t(!1)}}}function b(e,t){let n;function r(){if(!n)return!1;const e=n;return n=void 0,e.forEach(e=>e()),!0}function f(){r()&&t(!0)}function c(){r();const o=new Map;try{return i(e,o)}catch(e){throw o.clear(),e}finally{if(o.size){n=[];for(let[e,t]of o)for(const r of t)n.push(v(h(e),r,f))}else t(!1)}}return t=o(t),c.stop=()=>{r()&&t(!1)},c}const _=new WeakSet;function O(e){return _.has(e)}function m(e,t,n=(()=>{}),r=(()=>{})){function f(e,n=!1){if(t)try{t(e,()=>{n=!0})}finally{n&&a()}}function c(){return u(i,"value"),e()}const i=(...e)=>e.length?(f(e[0],e[1]),e[0]):c();function l(e){if(!s)return()=>{};e=o(e),s.push(e),r();let t=!1;return()=>{if(t)return;if(t=!0,!s)return;const n=s.findIndex(t=>t===e);n<0||(s.splice(n,1),r())}}Reflect.defineProperty(i,"value",{get:c,set:f,enumerable:!0,configurable:!0});let s=[];Reflect.defineProperty(i,"watch",{get:()=>l,set(){},configurable:!0});const a=()=>{if(s){d(i,"value");for(const e of[...s])e(i,!1)}};a.has=()=>{var e;return Boolean(null===(e=s)||void 0===e?void 0:e.length)},a.stop=()=>{if(!s)return;const e=s;s=void 0;for(const t of[...e])t(i,!0)},_.add(i);let p=!1;return i.stop=()=>{p||(p=!0,n(),a.stop())},{value:i,trigger:a}}function x(e,t){const n=!0===t||t&&t.proxy;let r,o;const{value:f}=m(()=>o,(e,t)=>{n&&(e=h(e)),e!==r&&(r=e,o=n?R(r):r,t())});return f(e),f}function M(e,t,n){"function"!=typeof t&&(n=t,t=void 0);const r=t,o=!0===n||n&&n.proxy;let f,c,u,i=!1,l=!1;const s=b(e,e=>{l=!e,e&&u&&u()});function a(){l=!0;try{return f=s(),o&&(f=h(f)),c=o?R(f):f,c}catch(e){throw i||(l=!1),e}}let p;return({value:p,trigger:u}=m(()=>l||i?c:a(),r&&(e=>r(o?h(e):e)),()=>{i||(i=!0,l||a())})),p}function S(e){let t,n=!1;return(r,o)=>{if(o)return e(r,o);const f=h(r());f===t&&n||(n=!0,t=f,e(r,o))}}function j(e){for(const t of Reflect.ownKeys(e)){const n=Reflect.getOwnPropertyDescriptor(e,t);if(!n)continue;if(!("value"in n)||"get"in n||"set"in n)continue;const r=n.value;O(r)&&(n.get=()=>r.value,n.writable&&(n.set=e=>r.value=e),delete n.value,delete n.writable,Reflect.defineProperty(e,t,n))}return e}export{M as computed,b as createExecutable,R as encase,r as encashable,w as equal,P as exec,f as getIndexes,c as getMapValue,O as isValue,d as markChange,u as markRead,S as merge,j as mix,i as observe,y as postpone,n as printError,h as recover,o as safeify,x as value,v as watchProp};
//# sourceMappingURL=monitorable.esm.min.js.map
