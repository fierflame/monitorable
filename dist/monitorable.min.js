/*!
 * monitorable v0.1.0-alpha.7
 * (c) 2020 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Monitorable={})}(this,(function(e){"use strict";let t,n;function o(e){"function"!=typeof t?console.error(e):t(e)}function r(e){return(...t)=>{try{e(...t)}catch(e){o(e)}}}function f(e,t){if(e&&("function"==typeof e||"object"==typeof e))return"number"==typeof t?[e,String(t)]:"symbol"==typeof t||"string"==typeof t||"boolean"==typeof t?[e,t]:void 0}function i(e,t,n){if(e.has(t))return e.get(t);const o=n();return e.set(t,o),o}function u(e,t){if(!n)return;const o=f(e,t);if(!o)return;[e,t]=o;const r=i(n,e,()=>new Map);r.has(t)||r.set(t,!1)}function c(e,t,o){const r=n;n=e;try{return(null==o?void 0:o.postpone)?v(t,"priority"===o.postpone):t()}finally{n=r}}function l(e,t,n){if("function"==typeof t)return c(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return c(e,n,t)}const s=new WeakMap;function a(e,t){var n;const o=null===(n=s.get(e))||void 0===n?void 0:n.get(t);o&&[...o].forEach(e=>e())}let p,y;function d(e,t){const o=!t&&p||new Map,r=p;p=o;try{return e()}finally{p=r,o!==p&&function(e){for(const[o,r]of e.entries()){var t;const e=null===(t=n)||void 0===t?void 0:t.get(o);for(const t of r)a(o,t),(null==e?void 0:e.has(t))&&e.set(t,!0)}}(o)}}function v(e,t){if("function"==typeof e)return d(e,t);if("function"!=typeof t)throw new Error("fn needs to be a function");return d(t,e)}function g(e,t){const n=f(e,t);n&&([e,t]=n,function(e,t){return!!p&&(i(p,e,()=>new Set).add(t),!0)}(e,t)||a(e,t))}function b(e,t,n){if("function"!=typeof n)return()=>{};const o=f(e,t);if(!o)return()=>{};[e,t]=o;const u=t;let c=s.get(e);c||(c=new Map,s.set(e,c));const l=i(c,u,()=>new Set);n=r(n),l.add(n);let a=!1;return()=>{a||(a=!0,l.delete(n),l.size||c&&(c.delete(u),c.size||s.delete(e)))}}function h(e){return Boolean(e&&["object","function"].includes(typeof e))}function w(e,t=0){if(!h(e))return e;const n=R(e),o=!0===t?1/0:t||0,r=new Proxy(n,{set(e,n,o,r){if(!1===t)return Reflect.set(e,n,o,r);const f=Reflect.has(e,n),i=Reflect.set(e,n,o,w(r));return i?(f!==Reflect.has(e,n)&&g(e,!0),i):i},get(e,f,i){if(y===r&&"__monitorable__recover__"===f)return void(y=n);if(!1===t)return Reflect.get(e,f,i);u(e,f);const c=Reflect.get(e,f,w(i));return o>0?w(c,o-1):c},setPrototypeOf(e,n){if(!1===t)return Reflect.setPrototypeOf(e,n);const o=Reflect.getPrototypeOf(e),r=Reflect.setPrototypeOf(e,n);return r&&o!==n&&g(e,!1),r},getPrototypeOf(e){if(!1===t)return Reflect.getPrototypeOf(e);u(e,!1);const n=Reflect.getPrototypeOf(e);return o>0?w(n,o-1):n},defineProperty(e,n,o){if(!1===t)return Reflect.defineProperty(e,n,o);let r=!0;if("value"in o){const t=Reflect.getOwnPropertyDescriptor(e,n);t&&"value"in t&&R(o.value)===R(t.value)&&(r=!1)}const f=Reflect.defineProperty(e,n,o);return r&&f&&g(e,n),f},getOwnPropertyDescriptor:(e,n)=>(!1===t||u(e,n),Reflect.getOwnPropertyDescriptor(e,n)),deleteProperty(e,n){if(!1===t)return Reflect.deleteProperty(e,n);const o=Reflect.has(e,n),r=Reflect.deleteProperty(e,n);return o&&!Reflect.has(e,n)&&(g(e,n),g(e,!0)),r},ownKeys:e=>(!1===t||u(e,!0),Reflect.ownKeys(e)),has:(e,n)=>(!1===t||u(e,!0),Reflect.has(e,n))});return r}function R(e){if(!e)return e;if(!h(e))return e;let t=e;try{y=e,t=e.__monitorable__recover__}catch(e){}return t=y,y=!1,t&&("object"==typeof t||"function"==typeof t)?t:e}function P(e,t,n){let o;e=r(e);const f=null==n?void 0:n.postpone;let i=!1;function u(){if(i)return!1;if(i=!0,!o)return!0;const e=o;return o=void 0,e.forEach(e=>e()),!0}function c(){u()&&e(!0)}function s(){u()&&e(!1)}const a=new Map,p=l(a,()=>t(s),{postpone:f});return function(t){if(i)return!1;if(!t.size)return i=!0,e(!1);const n=[];for(let[o,r]of t)for(const[t,f]of r){if(f)return e(!0);n.push([o,t])}o=n.map(([e,t])=>b(R(e),t,c))}(a),(null==n?void 0:n.resultOnly)?p:{result:p,stop:s}}function m(e,t,n){let o;function f(){if(!o)return!1;const e=o;return o=void 0,e.forEach(e=>e()),!0}function i(){f()&&e(!0)}function u(){f();const r=new Map,u=l(r,t,n);return function(t){if(!t.size)return e(!1);const n=[];for(let[o,r]of t)for(const[t,f]of r){if(f)return e(!0);n.push([o,t])}o=n.map(([e,t])=>b(R(e),t,i))}(r),u}return e=r(e),u.stop=()=>{f()&&e(!1)},u}function O(e,t,n){if("function"==typeof t)return m(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return m(e,n,t)}const S=new WeakSet;function _(e){return S.has(e)}function x(){const e=this();return null==e?e:e.valueOf()}function E(...e){const t=this();return null==t?String(t):"function"==typeof t.toString?t.toString(...e):String(t)}function M(e){const t=this();return null==t?String(t):"function"==typeof t[Symbol.toPrimitive]?t[Symbol.toPrimitive](e):"string"===e?String(t):"number"===e?Number(t):t}function j(e,t,n=(()=>{}),o=(()=>{})){function f(e,n=!1){if(t)try{t(e,()=>{n=!0})}finally{n&&a()}}function i(){return u(c,"value"),e()}const c=(...e)=>e.length?(f(e[0],e[1]),e[0]):i();function l(e){if(!s)return()=>{};e=r(e),s.push(e),o();let t=!1;return()=>{if(t)return;if(t=!0,!s)return;const n=s.findIndex(t=>t===e);n<0||(s.splice(n,1),o())}}Reflect.defineProperty(c,"value",{get:i,set:f,enumerable:!0,configurable:!0}),Reflect.defineProperty(c,"valueOf",{value:x,enumerable:!0,configurable:!0}),Reflect.defineProperty(c,"toString",{value:E,enumerable:!0,configurable:!0}),Reflect.defineProperty(c,Symbol.toPrimitive,{value:M,enumerable:!0,configurable:!0});let s=[];Reflect.defineProperty(c,"watch",{get:()=>l,set(){},configurable:!0});const a=()=>{if(s){g(c,"value");for(const e of[...s])e(c,!1)}};a.has=()=>{var e;return Boolean(null===(e=s)||void 0===e?void 0:e.length)},a.stop=()=>{if(!s)return;const e=s;s=void 0;for(const t of[...e])t(c,!0)},S.add(c);let p=!1;return c.stop=()=>{p||(p=!0,n(),a.stop())},{value:c,trigger:a}}function k(e,t){const n=!0===t||t&&t.proxy;let o,r;const{value:f}=j(()=>r,(e,t)=>{n&&(e=R(e)),e!==o&&(o=e,r=n?w(o):o,t())});return f(e),f}function z(e,t,n){var o;"function"!=typeof t&&(n=t,t=void 0);const r=t,f=!0===n||n&&n.proxy,i="object"==typeof n&&(null===(o=n)||void 0===o?void 0:o.postpone);let u,c,l,s=!1,a=!1;const p=O(e=>{a=!e,e&&l&&l()},e,{postpone:i});function y(){a=!0;try{return u=p(),f&&(u=R(u)),c=f?w(u):u,c}catch(e){throw s||(a=!1),e}}let d;return({value:d,trigger:l}=j(()=>a||s?c:y(),r&&(e=>r(f?R(e):e)),()=>{s||(s=!0,a||y())})),d}function D(e,t,n=k(void 0),o){function r(e,t){o&&o(e,t)}return z(()=>{if(!(t in e))return n();const o=e[t];return _(o)?o():o},o=>{if(!(t in e))return n(o),void r(o,!1);const f=e[t];if(_(f))return f(o),void r(o,!0);r(o,!1)})}e.computed=z,e.createExecutable=O,e.encase=w,e.encashable=function(e){return Boolean(e&&["object","function"].includes(typeof e))},e.equal=function(e,t){return R(e)===R(t)},e.exec=function(e,t,n){if("function"!=typeof e)throw new Error("cb needs to be a function");if("function"==typeof t)return P(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return P(e,n,t)},e.getIndexes=f,e.getMapValue=i,e.isValue=_,e.markChange=g,e.markRead=u,e.merge=function(e){let t,n=!1;return(o,r)=>{if(r)return e(o,r);const f=R(o());f===t&&n||(n=!0,t=f,e(o,r))}},e.mix=function(e){for(const t of Reflect.ownKeys(e)){const n=Reflect.getOwnPropertyDescriptor(e,t);if(!n)continue;if(!("value"in n)||"get"in n||"set"in n)continue;const o=n.value;_(o)&&(n.get=()=>o.value,n.writable&&(n.set=e=>o.value=e),delete n.value,delete n.writable,Reflect.defineProperty(e,t,n))}return e},e.observe=l,e.observeRun=c,e.postpone=v,e.printError=o,e.recover=R,e.safeify=r,e.setPrintError=function(e){t="function"==typeof e?e:void 0},e.value=k,e.valueify=function(e,t,n,o){return arguments.length>=2?D(e,t,n,o):(t,n,o)=>D(e,t,n,o)},e.watchProp=b,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=monitorable.min.js.map
