/*!
 * monitorable v0.1.0-alpha.0
 * (c) 2020 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Monitorable={})}(this,(function(e){"use strict";let t;function n(e,n=!1){n||"function"!=typeof e&&void 0!==e?"function"!=typeof t?console.error(e):t(e):t=e}function r(e){return(...t)=>{try{e(...t)}catch(e){n(e,!0)}}}function o(e,t,n){if(e.has(t))return e.get(t);const r=n();return e.set(t,r),r}const f=new WeakMap;function c(e,t=0){if(n=e,!Boolean(n&&["object","function"].includes(typeof n)))return e;var n;if(f.has(e))return e;const r=!0===t?1/0:t||0;return new Proxy(e,{set(e,n,r,o){if(!1===t)return Reflect.set(e,n,r,o);const f=Reflect.has(e,n),i=Reflect.set(e,n,r,c(o));return i?(f!==Reflect.has(e,n)&&p(e,!0),i):i},get(e,n,o){if(!1===t)return Reflect.get(e,n,o);l(e,n);const f=Reflect.get(e,n,c(o));return r>0?c(f,r-1):f},setPrototypeOf(e,n){if(!1===t)return Reflect.setPrototypeOf(e,n);const r=Reflect.getPrototypeOf(e),o=Reflect.setPrototypeOf(e,n);return o&&r!==n&&p(e,!1),o},getPrototypeOf(e){if(!1===t)return Reflect.getPrototypeOf(e);l(e,!1);const n=Reflect.getPrototypeOf(e);return r>0?c(n,r-1):n},defineProperty(e,n,r){if(!1===t)return Reflect.defineProperty(e,n,r);let o=!0;if("value"in r){const t=Reflect.getOwnPropertyDescriptor(e,n);t&&"value"in t&&i(r.value)===i(t.value)&&(o=!1)}const f=Reflect.defineProperty(e,n,r);return o&&f&&p(e,n),f},getOwnPropertyDescriptor:(e,n)=>!1===t?Reflect.getOwnPropertyDescriptor(e,n):(l(e,n),Reflect.getOwnPropertyDescriptor(e,n)),deleteProperty(e,n){if(!1===t)return Reflect.deleteProperty(e,n);const r=Reflect.has(e,n),o=Reflect.deleteProperty(e,n);return r&&!Reflect.has(e,n)&&(p(e,n),p(e,!0)),o},ownKeys:e=>!1===t?Reflect.ownKeys(e):(l(e,!0),Reflect.ownKeys(e)),has:(e,n)=>!1===t?Reflect.has(e,n):(l(e,!0),Reflect.has(e,n))})}function i(e){return f.get(e)||e}let u;function l(e,t){if(!u)return;const n=o(u,e,()=>new Set);"number"==typeof t&&(t=String(t)),n.add(t)}function s(e,t=new Map,n=!1){const r=u;u=t;try{return e()}catch(e){throw n&&t.clear(),e}finally{u=r}}const a=new WeakMap;function p(e,t){var n,r;if(!e)return;if("object"!=typeof e&&"function"!=typeof e)return;if("number"==typeof t)t=String(t);else if("symbol"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return;const o=null===(n=a.get(e))||void 0===n?void 0:null===(r=n.get)||void 0===r?void 0:r.call(n,t);if(o)for(const e of[...o])e()}function y(e,t,n){if(!e)return()=>{};if("object"!=typeof e&&"function"!=typeof e)return()=>{};if("function"!=typeof n)return()=>{};if("number"==typeof t&&(t=String(t)),"symbol"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return()=>{};const f=t;e=i(e);let c=a.get(e);c||(c=new Map,a.set(e,c));const u=o(c,f,()=>new Set);n=r(n),u.add(n);let l=!1;return()=>{l||(l=!0,u.delete(n),u.size||c&&(c.delete(f),c.size||a.delete(e)))}}function d(e,t){let n;function o(){if(!n)return!1;const e=n;return n=void 0,e.forEach(e=>e()),!0}function f(){o()&&t(!0)}function c(){o();const r=new Map;try{return s(e,r,!0)}finally{if(r.size){n=[];for(let[e,t]of r)for(const r of t)n.push(y(e,r,f))}else t(!1)}}return t=r(t),c.stop=()=>{o()&&t(!1)},c}const g=new WeakSet;function v(e){return g.has(e)}function R(e,t,n=(()=>{}),o=(()=>{})){function f(e,n=!1){if(t)try{t(e,()=>{n=!0})}finally{n&&a()}}function c(){return l(i,"value"),e()}const i=(...e)=>e.length?(f(e[0],e[1]),e[0]):c();function u(e){if(!s)return()=>{};e=r(e),s.push(e),o();let t=!1;return()=>{if(t)return;if(t=!0,!s)return;const n=s.findIndex(t=>t===e);n<0||(s.splice(n,1),o())}}Reflect.defineProperty(i,"value",{get:c,set:f,enumerable:!0,configurable:!0});let s=[];Reflect.defineProperty(i,"watch",{get:()=>u,set(){},configurable:!0});const a=()=>{if(s){p(i,"value");for(const e of[...s])e(i,!1)}};a.has=()=>{var e;return Boolean(null===(e=s)||void 0===e?void 0:e.length)},a.stop=()=>{if(!s)return;const e=s;s=void 0;for(const t of[...e])t(i,!0)},g.add(i);let y=!1;return i.stop=()=>{y||(y=!0,n(),a.stop())},{value:i,trigger:a}}e.computed=function(e,t,n){"function"!=typeof t&&(n=t,t=void 0);const r=t,o=!0===n||n&&n.proxy;let f,u,l,s=!1,a=!1;const p=d(e,e=>{a=!e,e&&l&&l()});function y(){a=!0;try{return f=p(),o&&(f=i(f)),u=o?c(f):f,u}catch(e){throw s||(a=!1),e}}let g;return({value:g,trigger:l}=R(()=>a||s?u:y(),r&&(e=>r(o?i(e):e)),()=>{s||(s=!0,a||y())})),g},e.createExecutable=d,e.equal=function(e,t){return i(e)===i(t)},e.getMepValue=o,e.getProxy=c,e.getValue=i,e.isValue=v,e.markChange=p,e.markRead=l,e.merge=function(e){let t,n=!1;return(r,o)=>{if(o)return e(r,o);const f=i(r());f===t&&n||(n=!0,t=f,e(r,o))}},e.mix=function(e){for(const t of Reflect.ownKeys(e)){const n=Reflect.getOwnPropertyDescriptor(e,t);if(!n)continue;if("get"in n||"set"in n||!("value"in n))continue;const r=n.value;v(r)&&(n.get=()=>r.value,n.writable&&(n.set=e=>r.value=e),delete n.value,delete n.writable,Reflect.defineProperty(e,t,n))}return e},e.observe=s,e.printError=n,e.safeify=r,e.value=function(e,t){const n=!0===t||t&&t.proxy;let r,o;const{value:f}=R(()=>o,(e,t)=>{n&&(e=i(e)),e!==r&&(r=e,o=n?c(r):r,t())});return f(e),f},e.watchProp=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=monitorable.min.js.map
