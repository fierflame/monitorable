/*!
 * monitorable v0.1.0-alpha.2
 * (c) 2020 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Monitorable={})}(this,(function(e){"use strict";let t,n,r;function o(e,n=!1){n||"function"!=typeof e&&void 0!==e?"function"!=typeof t?console.error(e):t(e):t=e}function f(e){return(...t)=>{try{e(...t)}catch(e){o(e,!0)}}}function c(e,t,n){if(e.has(t))return e.get(t);const r=n();return e.set(t,r),r}function i(e){return Boolean(e&&["object","function"].includes(typeof e))}function u(e,t=0){if(!i(e))return e;const r=l(e),o=!0===t?1/0:t||0,f=new Proxy(r,{set(e,n,r,o){if(!1===t)return Reflect.set(e,n,r,o);const f=Reflect.has(e,n),c=Reflect.set(e,n,r,u(o));return c?(f!==Reflect.has(e,n)&&y(e,!0),c):c},get(e,c,i){if(n===f&&"__monitorable__recover__"===c)return void(n=r);if(!1===t)return Reflect.get(e,c,i);s(e,c);const l=Reflect.get(e,c,u(i));return o>0?u(l,o-1):l},setPrototypeOf(e,n){if(!1===t)return Reflect.setPrototypeOf(e,n);const r=Reflect.getPrototypeOf(e),o=Reflect.setPrototypeOf(e,n);return o&&r!==n&&y(e,!1),o},getPrototypeOf(e){if(!1===t)return Reflect.getPrototypeOf(e);s(e,!1);const n=Reflect.getPrototypeOf(e);return o>0?u(n,o-1):n},defineProperty(e,n,r){if(!1===t)return Reflect.defineProperty(e,n,r);let o=!0;if("value"in r){const t=Reflect.getOwnPropertyDescriptor(e,n);t&&"value"in t&&l(r.value)===l(t.value)&&(o=!1)}const f=Reflect.defineProperty(e,n,r);return o&&f&&y(e,n),f},getOwnPropertyDescriptor:(e,n)=>!1===t?Reflect.getOwnPropertyDescriptor(e,n):(s(e,n),Reflect.getOwnPropertyDescriptor(e,n)),deleteProperty(e,n){if(!1===t)return Reflect.deleteProperty(e,n);const r=Reflect.has(e,n),o=Reflect.deleteProperty(e,n);return r&&!Reflect.has(e,n)&&(y(e,n),y(e,!0)),o},ownKeys:e=>!1===t?Reflect.ownKeys(e):(s(e,!0),Reflect.ownKeys(e)),has:(e,n)=>!1===t?Reflect.has(e,n):(s(e,!0),Reflect.has(e,n))});return f}function l(e){if(!e)return e;if(!i(e))return e;let t=e;try{n=e,t=e.__monitorable__recover__}catch(e){}return t=n,n=!1,t?"object"==typeof t?t:"function"==typeof t?t:e:e}function s(e,t){if(!r)return;const n=c(r,e,()=>new Set);"number"==typeof t&&(t=String(t)),n.add(t)}function a(e,t=new Map,n=!1){const o=r;r=t;try{return e()}catch(e){throw n&&t.clear(),e}finally{r=o}}const p=new WeakMap;function y(e,t){var n,r;if(!e)return;if(!i(e))return;if("number"==typeof t)t=String(t);else if("symbol"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return;const o=null===(n=p.get(e))||void 0===n?void 0:null===(r=n.get)||void 0===r?void 0:r.call(n,t);if(o)for(const e of[...o])e()}function d(e,t,n){if(!e)return()=>{};if("object"!=typeof e&&"function"!=typeof e)return()=>{};if("function"!=typeof n)return()=>{};if("number"==typeof t&&(t=String(t)),"symbol"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return()=>{};const r=t;e=l(e);let o=p.get(e);o||(o=new Map,p.set(e,o));const i=c(o,r,()=>new Set);n=f(n),i.add(n);let u=!1;return()=>{u||(u=!0,i.delete(n),i.size||o&&(o.delete(r),o.size||p.delete(e)))}}function g(e,t){let n;function r(){if(!n)return!1;const e=n;return n=void 0,e.forEach(e=>e()),!0}function o(){r()&&t(!0)}function c(){r();const f=new Map;try{return a(e,f,!0)}finally{if(f.size){n=[];for(let[e,t]of f)for(const r of t)n.push(d(e,r,o))}else t(!1)}}return t=f(t),c.stop=()=>{r()&&t(!1)},c}const v=new WeakSet;function R(e){return v.has(e)}function h(e,t,n=(()=>{}),r=(()=>{})){function o(e,n=!1){if(t)try{t(e,()=>{n=!0})}finally{n&&a()}}function c(){return s(i,"value"),e()}const i=(...e)=>e.length?(o(e[0],e[1]),e[0]):c();function u(e){if(!l)return()=>{};e=f(e),l.push(e),r();let t=!1;return()=>{if(t)return;if(t=!0,!l)return;const n=l.findIndex(t=>t===e);n<0||(l.splice(n,1),r())}}Reflect.defineProperty(i,"value",{get:c,set:o,enumerable:!0,configurable:!0});let l=[];Reflect.defineProperty(i,"watch",{get:()=>u,set(){},configurable:!0});const a=()=>{if(l){y(i,"value");for(const e of[...l])e(i,!1)}};a.has=()=>{var e;return Boolean(null===(e=l)||void 0===e?void 0:e.length)},a.stop=()=>{if(!l)return;const e=l;l=void 0;for(const t of[...e])t(i,!0)},v.add(i);let p=!1;return i.stop=()=>{p||(p=!0,n(),a.stop())},{value:i,trigger:a}}e.computed=function(e,t,n){"function"!=typeof t&&(n=t,t=void 0);const r=t,o=!0===n||n&&n.proxy;let f,c,i,s=!1,a=!1;const p=g(e,e=>{a=!e,e&&i&&i()});function y(){a=!0;try{return f=p(),o&&(f=l(f)),c=o?u(f):f,c}catch(e){throw s||(a=!1),e}}let d;return({value:d,trigger:i}=h(()=>a||s?c:y(),r&&(e=>r(o?l(e):e)),()=>{s||(s=!0,a||y())})),d},e.createExecutable=g,e.encase=u,e.equal=function(e,t){return l(e)===l(t)},e.getMapValue=c,e.isValue=R,e.markChange=y,e.markRead=s,e.merge=function(e){let t,n=!1;return(r,o)=>{if(o)return e(r,o);const f=l(r());f===t&&n||(n=!0,t=f,e(r,o))}},e.mix=function(e){for(const t of Reflect.ownKeys(e)){const n=Reflect.getOwnPropertyDescriptor(e,t);if(!n)continue;if(!("value"in n)||"get"in n||"set"in n)continue;const r=n.value;R(r)&&(n.get=()=>r.value,n.writable&&(n.set=e=>r.value=e),delete n.value,delete n.writable,Reflect.defineProperty(e,t,n))}return e},e.observe=a,e.printError=o,e.recover=l,e.safeify=f,e.value=function(e,t){const n=!0===t||t&&t.proxy;let r,o;const{value:f}=h(()=>o,(e,t)=>{n&&(e=l(e)),e!==r&&(r=e,o=n?u(r):r,t())});return f(e),f},e.watchProp=d,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=monitorable.min.js.map
