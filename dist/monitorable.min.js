/*!
 * monitorable v0.1.0-beta.1
 * (c) 2020-2021 Fierflame
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Monitorable={})}(this,(function(e){"use strict";let t,n;function r(e){"function"!=typeof t?console.error(e):t(e)}function o(e){t="function"==typeof e?e:void 0}function f(e){return Boolean(e&&["object","function"].includes(typeof e))}function u(e){return(...t)=>{try{e(...t)}catch(e){r(e)}}}function i(e){try{e()}catch(e){r(e)}}function c(e,t){if(e&&("function"==typeof e||"object"==typeof e))return"number"==typeof t?[e,String(t)]:"symbol"==typeof t||"string"==typeof t||"boolean"==typeof t?[e,t]:void 0}function l(e,t,n){if(e.has(t))return e.get(t);const r=n();return e.set(t,r),r}function s(e,t){if(!n)return;const r=c(e,t);if(!r)return;[e,t]=r;const o=l(n,e,()=>new Map);o.has(t)||o.set(t,!1)}function a(e,t,r){const o=n;n=e;try{return(null==r?void 0:r.postpone)?b(t,"priority"===r.postpone):t()}finally{n=o}}function p(e,t,n){if("function"==typeof t)return a(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return a(e,n,t)}const d=new WeakMap;function y(e,t,n){var r;const o=null===(r=d.get(e))||void 0===r?void 0:r.get(t);if(!o)return;let f=[...o];n&&(f=f.filter(([,e])=>n(e))),f.forEach(([e])=>e())}let v;function g(e,t){const r=!t&&v||new Map,o=v;v=r;try{return e()}finally{v=o,r!==v&&function(e){for(const[r,o]of e.entries()){var t;const e=null===(t=n)||void 0===t?void 0:t.get(r);for(const t of o)y(r,t,e=>!e),(null==e?void 0:e.has(t))&&e.set(t,!0)}}(r)}}function b(e,t){if("function"==typeof e)return g(e,t);if("function"!=typeof t)throw new Error("fn needs to be a function");return g(t,e)}function h(e,t){const n=c(e,t);n&&([e,t]=n,!function(e,t){return!!v&&(l(v,e,()=>new Set).add(t),!0)}(e,t)?y(e,t):y(e,t,Boolean))}function m(e,t,n,r=!1){if("function"!=typeof n)return()=>{};const o=c(e,t);if(!o)return()=>{};[e,t]=o;const f=t;let i=d.get(e);i||(i=new Map,d.set(e,i));const s=l(i,f,()=>new Set),a=[u(n),r];s.add(a);let p=!1;return()=>{p||(p=!0,s.delete(a),s.size||i&&(i.delete(f),i.size||d.delete(e)))}}function P(e,t,n){let r;e=u(e);const o=null==n?void 0:n.postpone;let f=!1;function i(){if(f)return!1;if(f=!0,!r)return!0;const e=r;return r=void 0,e.forEach(e=>e()),!0}function c(){i()&&e(!0)}function l(){i()&&e(!1)}const s=new Map,a=p(s,()=>t(l),{postpone:o});return function(t){if(f)return!1;if(!t.size)return f=!0,e(!1);const o=[];for(let[n,r]of t)for(const[t,f]of r){if(f)return e(!0);o.push([n,t])}r=o.map(([e,t])=>m(e,t,c,null==n?void 0:n.disdeferable))}(s),(null==n?void 0:n.resultOnly)?a:{result:a,stop:l}}function R(e,t,n){if("function"!=typeof e)throw new Error("cb needs to be a function");if("function"==typeof t)return P(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return P(e,n,t)}function w(e,t,n){let r;function o(){if(!r)return!1;const e=r;return r=void 0,e.forEach(e=>e()),!0}function f(){o()&&e(!0)}function i(...u){o();const i=new Map,c=p(i,()=>t(...u),n);return function(t){if(!t.size)return e(!1);const o=[];for(let[n,r]of t)for(const[t,f]of r){if(f)return e(!0);o.push([n,t])}r=o.map(([e,t])=>m(e,t,f,null==n?void 0:n.disdeferable))}(i),c}return e=u(e),i.stop=()=>{o()&&e(!1)},i}function O(e,t,n){if("function"==typeof t)return w(e,t,n);if("function"!=typeof n)throw new Error("fn needs to be a function");return w(e,n,t)}const _=new WeakSet;function S(e){return _.has(e)}function j(){const e=this();return null==e?e:e.valueOf()}function E(...e){const t=this();return null==t?String(t):"function"==typeof t.toString?t.toString(...e):String(t)}function x(e){const t=this();return null==t?String(t):"function"==typeof t[Symbol.toPrimitive]?t[Symbol.toPrimitive](e):"string"===e?String(t):"number"===e?Number(t):t}function M(e,t,n=(()=>{}),r=(()=>{})){function o(e,n=!1){if(t)try{t(e,()=>{n=!0})}finally{n&&a()}}function f(){return s(u,"value"),e()}const u=(...e)=>e.length?(o(e[0],e[1]),e[0]):f();Reflect.defineProperty(u,"value",{get:f,set:o,enumerable:!0,configurable:!0}),Reflect.defineProperty(u,"valueOf",{value:j,enumerable:!0,configurable:!0}),Reflect.defineProperty(u,"toString",{value:E,enumerable:!0,configurable:!0}),Reflect.defineProperty(u,Symbol.toPrimitive,{value:x,enumerable:!0,configurable:!0});let c=new Set;function l(e,t){if(!c)return()=>{};const n=m(u,"value",()=>e(u,!1),t);let o=!1;const f=()=>{o||(o=!0,c&&c.delete(f),n(),i(()=>e(u,!0)))};return c.add(f),r(),()=>{o||(o=!0,c&&c.delete(f),n(),r())}}Reflect.defineProperty(u,"watch",{get:()=>l,set(){},configurable:!0});const a=()=>h(u,"value");a.has=()=>{var e;return Boolean(null===(e=c)||void 0===e?void 0:e.size)},a.stop=()=>{if(!c)return;const e=c;c=void 0;for(const t of[...e])t()},_.add(u);let p=!1;return u.stop=()=>{p||(p=!0,n(),a.stop())},{value:u,trigger:a}}function V(e){let t,n;const{value:r}=M(()=>n,(e,r)=>{e!==t&&(t=e,n=t,r())});return r(e),r}function k(e,t,n){var r,o;"function"!=typeof t&&(n=t,t=void 0);const f=t,u=null===(r=n)||void 0===r?void 0:r.postpone,i=null===(o=n)||void 0===o?void 0:o.deferable;let c,l,s,a=!1,p=!1;const d=O(e=>{p=!e,e&&s&&s()},e,{postpone:u,disdeferable:!i});function y(){p=!0;try{return c=d(),l=c,l}catch(e){throw a||(p=!1),e}}let v;return({value:v,trigger:s}=M(()=>p||a?l:y(),f&&(e=>f(e)),()=>{a||(a=!0,p||y())})),v}function z(e,t,n,r){function o(e,t){r&&r(e,t)}return k(()=>{const r=e[t];return void 0===r&&n?n():S(r)?r():r},r=>{const f=e[t];return S(f)?(f(r),void o(r,!0)):void 0===f&&n?(n(r),void o(r,!1)):void o(r,!1)})}function A(e,t,n,r){if(!t)return(t,n,r)=>z(e,t,n,r);if(!Array.isArray(t))return z(e,t,n,r);const o=Object.create(null);for(const o of t){const t=z(e,o,n&&n(o),r&&((e,t)=>r(e,t,o)));Reflect.defineProperty(e,o,{get:()=>t(),set(e){t.value=e},configurable:!0,enumerable:!0})}return o}function B(e,t=Reflect.ownKeys(e),n){const r=Object.create(e);if(Array.isArray(t)){for(const o of t){const t=z(e,o,void 0,n&&((e,t)=>n(e,t,o)));Reflect.defineProperty(r,o,{get:()=>t(),set(e){t.value=e},configurable:!0,enumerable:!0})}return r}const o=Reflect.ownKeys(t);for(const f of o){const o=z(e,f,t[f],n&&((e,t)=>n(e,t,f)));Reflect.defineProperty(r,f,{get:()=>o(),set(e){o.value=e},configurable:!0,enumerable:!0})}return r}function C(e,t){return k(()=>{const n=e[t];return S(n)?n():n},n=>{const r=e[t];S(r)?r(n):e[t]=n})}function K(e,t){return arguments.length>=2?C(e,t):t=>C(e,t)}function D(e){let t,n=!1;return(r,o)=>{if(o)return e(r,o);const f=r();f===t&&n||(n=!0,t=f,e(r,o))}}function q(e,t,n){return Reflect.defineProperty(e,t,{get:()=>(s(e,t),n),set(r){r!==n&&(n=r,h(e,t))},configurable:!0,enumerable:!0})}function I(e,t={},n){const r=n||null===t?Object.create(t):t;for(const t of e){let e=r[t];Reflect.defineProperty(r,t,{get:()=>(s(r,t),e),set(n){n!==e&&(e=n,h(r,t))},configurable:!0,enumerable:!0})}return r}function W(e,t){return s(e,t),e[t]}function N(e,t,n){return n===e[t]||(e[t]=n,h(e,t)),n}function F(e){return Boolean(e&&["object","function"].includes(typeof e))}let G;function H(e,t=0){if(!F(e))return e;const n=J(e),r=!0===t?1/0:t||0,o=new Proxy(n,{set(e,n,r,o){if(!1===t)return Reflect.set(e,n,r,o);const f=Reflect.has(e,n),u=Reflect.get(e,n,o),i=Reflect.set(e,n,r,H(o));return i?(f!==Reflect.has(e,n)&&h(o,!0),u!==Reflect.get(e,n,o)&&h(o,n),i):i},get(e,f,u){if(G===o&&"__monitorable__recover__"===f)return void(G=n);if(!1===t)return Reflect.get(e,f,u);s(u,f);const i=Reflect.get(e,f,H(u));return r>0?H(i,r-1):i},setPrototypeOf(e,n){if(!1===t)return Reflect.setPrototypeOf(e,n);const r=Reflect.getPrototypeOf(e),f=Reflect.setPrototypeOf(e,n);return f&&r!==n&&(h(e,!1),h(o,!1)),f},getPrototypeOf(e){if(!1===t)return Reflect.getPrototypeOf(e);s(e,!1),s(o,!1);const n=Reflect.getPrototypeOf(e);return r>0?H(n,r-1):n},defineProperty(e,n,r){if(!1===t)return Reflect.defineProperty(e,n,r);let f=!0;if("value"in r){const t=Reflect.getOwnPropertyDescriptor(e,n);t&&"value"in t&&J(r.value)===J(t.value)&&(f=!1)}const u=Reflect.defineProperty(e,n,r);return f&&u&&(h(e,n),h(o,n)),u},getOwnPropertyDescriptor:(e,n)=>(!1===t||(s(e,n),s(o,n)),Reflect.getOwnPropertyDescriptor(e,n)),deleteProperty(e,n){if(!1===t)return Reflect.deleteProperty(e,n);const r=Reflect.has(e,n),f=Reflect.deleteProperty(e,n);return r&&!Reflect.has(e,n)&&(h(e,n),h(e,!0),h(o,n),h(o,!0)),f},ownKeys:e=>(!1===t||(s(e,!0),s(o,!0)),Reflect.ownKeys(e)),has:(e,n)=>(!1===t||(s(e,!0),s(o,!0)),Reflect.has(e,n))});return o}function J(e){if(!e)return e;if(!F(e))return e;let t=e;try{G=e,t=e.__monitorable__recover__}catch(e){}return t=G,G=!1,t&&("object"==typeof t||"function"==typeof t)?t:e}function L(e,t){return J(e)===J(t)}var Q=Object.freeze({__proto__:null,printError:r,setPrintError:o,encashable:f,safeify:u,safeCall:i,getIndexes:c,getMapValue:l,markRead:s,observe:p,postpone:b,markChange:h,watchProp:m,exec:R,monitor:O,isValue:S,value:V,computed:k,valueify:A,mixValue:B,asValue:K,merge:D,defineProperty:q,createObject:I,get:W,set:N,encase:H,recover:J,equal:L});e.asValue=K,e.computed=k,e.createObject=I,e.default=Q,e.defineProperty=q,e.encase=H,e.encashable=f,e.equal=L,e.exec=R,e.get=W,e.getIndexes=c,e.getMapValue=l,e.isValue=S,e.markChange=h,e.markRead=s,e.merge=D,e.mixValue=B,e.monitor=O,e.observe=p,e.postpone=b,e.printError=r,e.recover=J,e.safeCall=i,e.safeify=u,e.set=N,e.setPrintError=o,e.value=V,e.valueify=A,e.watchProp=m,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=monitorable.min.js.map
