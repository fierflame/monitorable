{"version":3,"file":"monitorable.esm.js","sources":["../src/utils.ts","../src/state.ts","../src/value.ts"],"sourcesContent":["/** 回调函数安全化处理 */\nexport function safeify<T extends any[]>(fn: (...p: T) => void): (...p: T) => void {\n\treturn (...p) => {\n\t\ttry {\n\t\t\tfn(...p);\n\t\t} catch(e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t};\n}\n","import { safeify } from './utils';\n\nconst ValueMap = new WeakMap<object | Function, object | Function>();\nconst ProxyHandler: ProxyHandler<any> = {\n\tget(target, prop, receiver) {\n\t\tmarkRead(target, typeof prop === 'number' ? String(prop) : prop);\n\t\treturn Reflect.get(target, prop, receiver);\n\t\t// return getProxy(Reflect.get(target, prop, receiver));\n\t},\n\tset(target, prop, value, receiver) {\n\t\tif (Reflect.get(target, prop, receiver) !== value) {\n\t\t\tmarkChange(target, typeof prop === 'number' ? String(prop) : prop);\n\t\t}\n\t\treturn Reflect.set(target, prop, value, receiver);\n\t},\n\t// getOwnPropertyDescriptor(target, prop) {\n\t// \tmarkRead(target, typeof prop === 'number' ? String(prop) : prop);\n\t// \tconst descriptor = Reflect.getOwnPropertyDescriptor(target, prop);\n\t// \tif (descriptor && 'value' in descriptor) {\n\t// \t\tdescriptor.value = getProxy(descriptor.value);\n\t// \t}\n\t// \treturn descriptor;\n\t// },\n\t// defineProperty(target, prop, attributes) {\n\t// \t// TODO\n\t// \treturn Reflect.defineProperty(target, prop, attributes);\n\t// },\n\t// deleteProperty(target, prop) {\n\t// \t// TODO\n\t// \treturn Reflect.deleteProperty(target, prop);\n\t// },\n\t// enumerate(target) {\n\t// \t// TODO\n\t// \treturn [...Reflect.enumerate(target)];\n\t// },\n};\n\nfunction isProxyable(v: any): v is object | Function {\n\treturn Boolean(v && ['object', 'function'].includes(typeof v));\n}\n\nexport function getProxy<T>(v: T): T {\n\tif (!isProxyable(v)) { return v; }\n\tif (ValueMap.has(v)) { return v; }\n\treturn new Proxy(v, ProxyHandler);\n}\nexport function getValue<T>(v: T): T {\n\treturn ValueMap.get(v as any) as T | undefined || v;\n}\nexport function equal(a: any, b: any): boolean {\n\treturn getValue(a) === getValue(b);\n}\n\n/** 已被读取的 */\nlet read: Map<object | Function, Set<string | symbol>> | undefined;\nexport function markRead(obj: object | Function, prop: string | symbol) {\n\tif (!read) { return; }\n\tlet set = read.get(obj);\n\tif (!set) {\n\t\tset = new Set();\n\t\tread.set(obj, set);\n\t}\n\tset.add(prop);\n}\nexport interface Executable<T> {\n\t(): T;\n\tstop(): void;\n}\nexport function createExecutable<T>(fn: () => T, cb: (changed: boolean) => void): Executable<T> {\n\tcb = safeify(cb);\n\tlet cancelList: (() => void)[] | undefined;\n\t/** 取消监听 */\n\tfunction cancel() {\n\t\tif (!cancelList) { return false; }\n\t\tconst list = cancelList;\n\t\tcancelList = undefined;\n\t\tlist.forEach(f => f());\n\t\treturn true;\n\t}\n\tfunction trigger() {\n\t\tif (!cancel()) { return; }\n\t\tcb(true);\n\t};\n\tfunction exec() {\n\t\tcancel();\n\t\tconst thisRead: typeof read = new Map();\n\t\tconst oldRead = read;\n\t\tread = thisRead;\n\t\ttry {\n\t\t\treturn fn();\n\t\t} catch (e) {\n\t\t\tthisRead.clear();\n\t\t\tthrow e;\n\t\t} finally {\n\t\t\tread = oldRead;\n\t\t\tif (thisRead.size) {\n\t\t\t\tcancelList = [];\n\t\t\t\tfor ( let [obj, props] of thisRead) {\n\t\t\t\t\tfor (const p of props) {\n\t\t\t\t\t\tcancelList.push(watchProp(obj, p, trigger));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcb(false);\n\t\t\t}\n\t\t}\n\t}\n\texec.stop = () => {\n\t\tif (!cancel()) { return; }\n\t\tcb(false);\n\t};\n\treturn exec;\n}\n\n\nexport const watchList = new WeakMap<object | Function, Map<string | symbol, (() => void)[]>>();\n\n/**\n * 监听对象属性的变化\n * @param v 要监听属性的值\n * @param key 要监听的属性名\n * @param f 属性改变后触发的函数\n */\nexport function watchProp(v: object | Function, key: string | symbol, f: () => void): () => void {\n\tif (!v) { return () => {}; }\n\tif (!(typeof v === 'object' || typeof v === 'function')) { return () => {}; }\n\tif (typeof f !== 'function') { return  () => {}; }\n\tif (typeof key !== 'symbol' && typeof key !== 'string') { return () => {}; }\n\tv = getValue(v);\n\tlet map = watchList.get(v);\n\tif (!map) {\n\t\tmap = new Map();\n\t\twatchList.set(v, map);\n\t}\n\tlet list = map.get(key);\n\tif (!list) {\n\t\tlist = [];\n\t\tmap.set(key, list);\n\t}\n\tlist.push(f);\n\tlet removed = false;\n\treturn () => {\n\t\tif (removed) { return; }\n\t\tremoved = true;\n\n\t\t// 从当前列表中移除\n\t\tif (!list) { return; }\n\t\tconst index = list.findIndex(a => a === f);\n\t\tif (index < 0) { return; }\n\t\tlist.splice(index, 1);\n\n\t\t// 从属性关联中删除\n\t\tif (list.length) { return; }\n\t\tif (!map) { return; }\n\t\tmap.delete(key);\n\n\t\t// 映射列表中删除\n\t\tif (map.size) { return; }\n\t\twatchList.delete(v);\n\t};\n\n}\n\n/** \n * 标记属性的修改，同时触发监听函数\n */\nexport function markChange(v: object | Function, key: string | symbol) {\n\tif (!v) { return; }\n\tif (!(typeof v === 'object' || typeof v === 'function')) { return; }\n\tif (typeof key === 'number') {\n\t\tkey = String(key);\n\t} else if (typeof key !== 'symbol' && typeof key !== 'string') {\n\t\treturn;\n\t}\n\n\tconst watch = watchList.get(v)?.get?.(key);\n\tif (!watch) { return; }\n\tfor (const w of [...watch]) {\n\t\ttry {\n\t\t\tw();\n\t\t} catch(e){\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n}\n","import { markRead, markChange, createExecutable, getValue, getProxy } from './state';\nimport { safeify } from './utils';\n\n/** 取消监听的方法 */\nexport interface CancelWatch {\n\t(): void;\n}\n/** 可监听值 */\nexport interface Value<T> {\n\t(): T;\n\t(v: T, mrak?: boolean): T;\n\tvalue: T;\n\twatch(cb: WatchCallback<T, this>): CancelWatch;\n\tstop(): void;\n}\n/** 监听函数 */\nexport interface WatchCallback<T, V extends Value<T> = Value<T>> {\n\t(v: V, stoped: boolean): void;\n}\nconst values = new WeakSet<Value<any>>();\nexport function isValue(x: any): x is Value<any> {\n\treturn values.has(x);\n}\n/** 触发监听 */\ninterface Trigger {\n\t(): void;\n\t/** 是否存在监听函数 */\n\thas(): boolean;\n\t/** 停止监听 */\n\tstop(): void;\n}\nexport interface Options {\n\tproxy?: boolean;\n}\n\n\nfunction createValue<T, V extends Value<T> = Value<T>>(\n\tsetValue: (value: T, markChange: () => void) => void,\n\tgetValue: () => T,\n\tstop: () => void = () => {},\n\tchange: () => void = () => {},\n) {\n\tfunction set(v: T, marked = false) {\n\t\ttry {\n\t\t\treturn setValue(v, () => { marked = true; });\n\t\t} finally {\n\t\t\tif (marked) {\n\t\t\t\ttrigger();\n\t\t\t}\n\t\t}\n\t}\n\tfunction get() {\n\t\tmarkRead(value, 'value');\n\t\treturn getValue();\n\t}\n\tconst value: V = ((...v: [T] | [T, boolean] | []): T => {\n\t\tif (v.length) {\n\t\t\tset(v[0], v[1]);\n\t\t\treturn v[0];\n\t\t}\n\t\treturn get();\n\t}) as V;\n\tReflect.defineProperty(value, 'value', {\n\t\tget,\n\t\tset,\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n\n\tfunction watch(cb: WatchCallback<T, V>): () => void {\n\t\tif (!callbacks) { return () => {}; }\n\t\tcb = safeify(cb);\n\t\tcallbacks.push(cb);\n\t\tchange();\n\t\tlet cancelled = false;\n\t\treturn () => {\n\t\t\tif (cancelled) { return; }\n\t\t\tcancelled = true;\n\t\t\tif (!callbacks) { return; }\n\t\t\tconst index = callbacks.findIndex(a => a === cb);\n\t\t\tif (index < 0) { return; }\n\t\t\tcallbacks.splice(index, 1);\n\t\t\tchange();\n\t\t};\n\t}\n\tlet callbacks: WatchCallback<T, V>[] | undefined = [];\n\tReflect.defineProperty(value, 'watch', {\n\t\tget() { return watch; },\n\t\tset() {},\n\t\tconfigurable: true,\n\t});\n\tconst trigger = (() => {\n\t\tif (!callbacks) { return; }\n\t\tmarkChange(value, 'value');\n\t\tfor (const cb of [...callbacks]) {\n\t\t\tcb(value, false);\n\t\t}\n\t}) as Trigger;\n\ttrigger.has = () => Boolean(callbacks?.length);\n\ttrigger.stop = () => {\n\t\tif (!callbacks) { return; }\n\t\tconst list = callbacks;\n\t\tcallbacks = undefined;\n\t\tfor (const cb of [...list]) {\n\t\t\tcb(value, true);\n\t\t}\n\t};\n\tvalues.add(value);\n\tlet stoped = false;\n\tvalue.stop = () => {\n\t\tif (stoped) { return; }\n\t\tstoped = true;\n\t\tstop();\n\t\ttrigger.stop();\n\n\t};\n\treturn {value, trigger};\n}\nexport function value<T>(value: T, options?: Options | boolean): Value<T>;\nexport function value<T>(def: T, options?: Options | boolean): Value<T> {\n\tconst proxy = options === true || options && options.proxy;\n\tlet source: T;\n\tlet proxyed: T;\n\tconst { value } = createValue<T>(\n\t\t(v, mark) => {\n\t\t\tif (proxy) { v = getValue(v); }\n\t\t\tif (v === source) { return; }\n\t\t\tsource = v;\n\t\t\tproxyed = proxy ? getProxy(source) : source;\n\t\t\tmark();\n\t\t},\n\t\t() => proxyed,\n\t);\n\tvalue(def);\n\treturn value;\n}\n\n/** 计算值 */\nexport function computed<T>(source: () => T, options?: Options | boolean): Value<T>;\nexport function computed<T>(getter: () => T, options?: Options | boolean): Value<T> {\n\tconst proxy = options === true || options && options.proxy;\n\tlet source: T;\n\tlet proxyed: T;\n\tlet stoped = false;\n\tlet computed = false;\n\tlet trigger: Trigger | undefined;\n\tconst executable = createExecutable(getter, changed => {\n\t\tcomputed = !changed;\n\t\tif (changed  && trigger) {\n\t\t\ttrigger();\n\t\t}\n\t});\n\tfunction run() {\n\t\tcomputed = true;\n\t\ttry {\n\t\t\tsource = executable();\n\t\t\tif (proxy) { source = getValue(source); }\n\t\t\tproxyed = proxy ? getProxy(source) : source;\n\t\t\treturn proxyed;\n\t\t} catch(e) {\n\t\t\tif (!stoped) {\n\t\t\t\tcomputed = false;\n\t\t\t}\n\t\t\tthrow e;\n\t\t}\n\n\t}\n\tlet value: Value<T>;\n\t({value, trigger} = createValue<T, Value<T>>(\n\t\t(v: T, mark) => {\n\t\t\t// TODO\n\t\t\t// v = getValue(v);\n\t\t\t// if (v === source) { return; }\n\t\t\t// source = v;\n\t\t\t// mark();\n\t\t},\n\t\t() => computed || stoped ? proxyed : run(),\n\t\t() => {\n\t\t\tif (stoped) { return; }\n\t\t\tstoped = true;\n\t\t\tif (computed) { return; }\n\t\t\trun();\n\t\t},\n\t));\n\treturn value;\n\n}\n\nexport function merge<T, V extends Value<T> = Value<T>>(cb: WatchCallback<T, V>): WatchCallback<T, V> {\n\tlet oldValue: any;\n\tlet runed = false;\n\treturn (v, stoped) => {\n\t\tif (stoped) { return cb(v, stoped); }\n\t\tconst newValue = getValue(v());\n\t\tif (newValue === oldValue && runed) { return; }\n\t\truned = true;\n\t\toldValue = newValue;\n\t\tcb(v, stoped);\n\t};\n}\n\ntype OffValue<V> = V extends Value<infer T> ? T : V;\n\nexport function mix<T extends object>(source: T): { [K in keyof T]: OffValue<T[K]>; } {\n\tfor (const k of Reflect.ownKeys(source)) {\n\t\tconst descriptor = Reflect.getOwnPropertyDescriptor(source, k);\n\t\tif (!descriptor) { continue; }\n\t\tif ('get' in descriptor || 'set' in descriptor || !('value' in descriptor)) { continue; }\n\t\tconst value = descriptor.value;\n\t\tif (!isValue(value)) { continue; }\n\t\tdescriptor.get = () => value();\n\t\tif (descriptor.writable) {\n\t\t\tdescriptor.set = (v) => value(v);\n\t\t}\n\t\tdelete descriptor.value;\n\t\tdelete descriptor.writable;\n\t\tReflect.defineProperty(source, k, descriptor);\n\t}\n\treturn source as any;\n}\n"],"names":["safeify","fn","p","e","console","error","ValueMap","WeakMap","ProxyHandler","get","target","prop","receiver","markRead","String","Reflect","set","value","markChange","isProxyable","v","Boolean","includes","getProxy","has","Proxy","getValue","read","obj","Set","add","createExecutable","cb","cancelList","cancel","list","undefined","forEach","f","trigger","exec","thisRead","Map","oldRead","clear","size","props","push","watchProp","stop","watchList","key","map","removed","index","findIndex","a","splice","length","delete","watch","w","values","WeakSet","isValue","x","createValue","setValue","change","marked","defineProperty","enumerable","configurable","callbacks","cancelled","stoped","def","options","proxy","source","proxyed","mark","computed","getter","executable","changed","run","merge","oldValue","runed","newValue","mix","k","ownKeys","descriptor","getOwnPropertyDescriptor","writable"],"mappings":"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"}