{"version":3,"file":"monitorable.esm.js","sources":["../src/utils.ts","../src/state.ts","../src/encase.ts","../src/exec.ts","../src/executable.ts","../src/value.ts"],"sourcesContent":["\nlet printErrorLog: undefined | ((info: any) => void);\n/** 设置或移除错误打印函数 */\nexport function printError(fn?: (info: any) => void): void;\n/** 打印错误 */\nexport function printError(info: any, print: true): void;\n/** 打印错误 */\nexport function printError(info: any): void;\nexport function printError(\n\tinfo?: string | Error | ((info: any) => void),\n\tprint = false\n) {\n\tif (!print && (typeof info === 'function' || info === undefined)) {\n\t\tprintErrorLog = info;\n\t\treturn;\n\t}\n\tif (typeof printErrorLog === 'function') {\n\t\tprintErrorLog(info);\n\t\treturn;\n\t}\n\tconsole.error(info);\n}\n\n/**\n * 判断对象是否可被代理\n */\nexport function encashable(v: any): v is object | Function {\n\treturn Boolean(v && ['object', 'function'].includes(typeof v));\n}\n\n\n/** 回调函数安全化处理 */\nexport function safeify<T extends any[]>(\n\tfn: (...p: T) => void\n): (...p: T) => void {\n\treturn (...p) => {\n\t\ttry {\n\t\t\tfn(...p);\n\t\t} catch(e) {\n\t\t\tprintError(e, true);\n\t\t}\n\t};\n}\nexport function getIndexes(\n\ttarget: any,\n\tprop: string | number | symbol | boolean,\n): [object | Function, string | boolean | symbol] | undefined {\n\tif (!target) { return undefined; }\n\tif (typeof target !== 'function' && typeof target !== 'object') {\n\t\treturn undefined;\n\t}\n\tif (typeof prop === 'number') { return [target, String(prop)]; }\n\tif (typeof prop === 'symbol') { return [target, prop]; }\n\tif (typeof prop === 'string') { return [target, prop]; }\n\tif (typeof prop === 'boolean') { return [target, prop]; }\n\treturn undefined;\n}\nexport function getMapValue<K, V>(\n\tmap: Map<K, V>,\n\tkey: K,\n\tdef: () => V,\n): V;\nexport function getMapValue<K extends object, V>(\n\tmap: WeakMap<K, V>,\n\tkey: K,\n\tdef: () => V,\n): V;\nexport function getMapValue<K, V>(\n\tmap: WeakMap<K & object, V> | Map<K, V>,\n\tkey: K,\n\tdef: () => V,\n): V {\n\tif (map.has(key as any)) {\n\t\treturn map.get(key as any)!;\n\t}\n\tconst value = def();\n\tmap.set(key as any, value);\n\treturn value;\n}\n","import { safeify, getMapValue, getIndexes } from './utils';\n\nexport type ReadMap =  Map<\n\tobject | Function,\n\tSet<string | boolean | symbol>\n>;\n\n/** 已被读取的 */\nlet read: ReadMap | undefined;\n\n/**\n * 标记已读状态\n * @param obj  要标记的对象\n * @param prop 要标记的属性\n */\nexport function markRead(\n\ttarget: object | Function,\n\tprop: string | number | boolean | symbol,\n) {\n\tif (!read) { return; }\n\tconst indexes = getIndexes(target, prop);\n\tif (!indexes) { return; }\n\t[target, prop] = indexes;\n\tgetMapValue(read, target, () => new Set()).add(prop);\n}\nexport interface ObserveOptions {\n\tpostpone?: boolean | 'priority';\n}\n/**\n * 监听函数的执行，并将执行过程中读取的对象值设置到 map 中\n * @param fn 要执行的含糊\n * @param map 用于存储被读取对象的 map\n */\nexport function observe<T>(\n\tfn: () => T,\n\tmap: ReadMap,\n\toptions?: ObserveOptions,\n): T {\n\tconst oldRead = read;\n\tread = map;\n\ttry {\n\t\tif (!options?.postpone) { return fn(); }\n\t\treturn postpone(fn, options.postpone === 'priority');\n\t} finally {\n\t\tread = oldRead;\n\t}\n}\n\n\nconst watchList = new WeakMap<\n\tobject | Function,\n\tMap<string | boolean | symbol, Set<() => void>>\n>();\n\nfunction execWatch(\n\ttarget: object | Function,\n\tprop: string | boolean | symbol,\n) {\n\tconst watch = watchList.get(target)?.get(prop);\n\tif (!watch) { return; }\n\t[...watch].forEach(w => w());\n}\n\nlet waitList: ReadMap | undefined;\n\nfunction run(list: ReadMap) {\n\tfor (const [target, set] of list.entries()) {\n\t\tfor (const prop of set) {\n\t\t\texecWatch(target, prop);\n\t\t}\n\t}\n}\nexport function postpone<T>(f: () => T, priority?: boolean): T {\n\tconst list = !priority && waitList || new Map();\n\tconst old = waitList;\n\twaitList = list;\n\ttry {\n\t\treturn f();\n\t} finally {\n\t\twaitList = old;\n\t\tif (list !== waitList) { run(list); }\n\t}\n}\n\nfunction wait(\n\ttarget: object | Function,\n\tprop: string | boolean | symbol,\n) {\n\tif (!waitList) { return false; }\n\tgetMapValue(waitList, target, () => new Set()).add(prop);\n\treturn true;\n}\n\n/**\n * 标记属性的修改，同时触发监听函数\n * @param target 要标记的对象\n * @param prop   要标记的属性 特别的，false 表示原型，true 表示成员\n */\nexport function markChange(\n\ttarget: object | Function,\n\tprop: string | number | boolean | symbol,\n) {\n\n\tconst indexes = getIndexes(target, prop);\n\tif (!indexes) { return; }\n\t[target, prop] = indexes;\n\tif (wait(target, prop)) { return; }\n\texecWatch(target, prop);\n}\n\n/**\n * 观察对象属性的变化\n * @param target 要观察的对象\n * @param prop   要观察的属性名 特别的，false 表示原型，true 表示成员\n * @param fn     属性改变后触发的函数\n */\nexport function watchProp(\n\ttarget: object | Function,\n\tprop: string | number | boolean | symbol,\n\tcb: () => void,\n): () => void {\n\tif (typeof cb !== 'function') { return  () => {}; }\n\tconst indexes = getIndexes(target, prop);\n\tif (!indexes) { return () => {}; }\n\t[target, prop] = indexes;\n\n\tconst key = prop;\n\tlet map = watchList.get(target);\n\tif (!map) {\n\t\tmap = new Map();\n\t\twatchList.set(target, map);\n\t}\n\tconst list = getMapValue(map, key, () => new Set());\n\tcb = safeify(cb);\n\tlist.add(cb);\n\tlet removed = false;\n\treturn () => {\n\t\tif (removed) { return; }\n\t\tremoved = true;\n\n\t\t// 从当前列表中移除\n\t\tlist.delete(cb);\n\n\t\t// 从属性关联中删除\n\t\tif (list.size) { return; }\n\t\tif (!map) { return; }\n\t\tmap.delete(key);\n\n\t\t// 映射列表中删除\n\t\tif (map.size) { return; }\n\t\twatchList.delete(target);\n\t};\n\n}\n","import { markChange, markRead } from './state';\n\n/**\n * 判断对象是否可被代理\n */\nfunction encashable(v: any): v is object | Function {\n\treturn Boolean(v && ['object', 'function'].includes(typeof v));\n}\n\nlet getValue: any;\n/**\n * 获取被代理对象\n * @param obj  要被代理的对象\n * @param nest 递归代理的层数\n */\nexport function encase<T>(value: T, nest: number | boolean = 0): T {\n\tif (!encashable(value)) { return value; }\n\tconst original = recover(value);\n\tconst nestLayer: number = nest === true ? Infinity : nest || 0;\n\tconst proxy = new Proxy(original, {\n\t\tset(target, prop, value, receiver) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.set(target, prop, value, receiver);\n\t\t\t}\n\t\t\tconst has = Reflect.has(target, prop);\n\t\t\tconst modified =\n\t\t\t\tReflect.set(target, prop, value, encase(receiver));\n\t\t\tif (!modified) { return modified; }\n\t\t\tif (has !== Reflect.has(target, prop)) {\n\t\t\t\tmarkChange(target, true);\n\t\t\t}\n\t\t\treturn modified;\n\t\t},\n\t\tget(target, prop, receiver) {\n\t\t\tif (getValue === proxy) {\n\t\t\t\tif (prop === '__monitorable__recover__') {\n\t\t\t\t\tgetValue = original;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.get(target, prop, receiver);\n\t\t\t}\n\t\t\tmarkRead(target, prop);\n\t\t\tconst value = Reflect.get(target, prop, encase(receiver));\n\t\t\tif (nestLayer > 0) { return encase(value, nestLayer - 1); }\n\t\t\treturn value;\n\t\t},\n\t\tsetPrototypeOf(target, proto) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.setPrototypeOf(target, proto);\n\t\t\t}\n\t\t\tconst oldProto = Reflect.getPrototypeOf(target);\n\t\t\tconst modified = Reflect.setPrototypeOf(target, proto);\n\t\t\tif (modified && oldProto !== proto) {\n\t\t\t\tmarkChange(target, false);\n\t\t\t}\n\t\t\treturn modified;\n\t\t},\n\t\tgetPrototypeOf(target) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.getPrototypeOf(target);\n\t\t\t}\n\t\t\tmarkRead(target, false);\n\t\t\tconst value: any = Reflect.getPrototypeOf(target);\n\t\t\tif (nestLayer > 0) {\n\t\t\t\treturn encase(value, nestLayer - 1);\n\t\t\t}\n\t\t\treturn value;\n\t\t},\n\t\tdefineProperty(target, prop, attr) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.defineProperty(target, prop, attr);\n\t\t\t}\n\t\t\tlet changed = true;\n\t\t\tif ('value' in attr) {\n\t\t\t\tconst desc =\n\t\t\t\t\tReflect.getOwnPropertyDescriptor(target, prop);\n\t\t\t\tif (\n\t\t\t\t\tdesc && 'value' in desc\n\t\t\t\t\t&& recover(attr.value) === recover(desc.value)) {\n\t\t\t\t\tchanged = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst modified = Reflect.defineProperty(target, prop, attr);\n\t\t\tif (changed && modified) {\n\t\t\t\tmarkChange(target, prop);\n\t\t\t}\n\t\t\treturn modified;\n\t\t},\n\t\tgetOwnPropertyDescriptor(target, prop) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.getOwnPropertyDescriptor(target, prop);\n\t\t\t}\n\t\t\tmarkRead(target, prop);\n\t\t\treturn Reflect.getOwnPropertyDescriptor(target, prop);\n\t\t},\n\t\tdeleteProperty(target, prop) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.deleteProperty(target, prop);\n\t\t\t}\n\t\t\tconst has = Reflect.has(target, prop);\n\t\t\tconst deleted = Reflect.deleteProperty(target, prop);\n\t\t\tif (has && !Reflect.has(target, prop)) {\n\t\t\t\tmarkChange(target, prop);\n\t\t\t\tmarkChange(target, true);\n\t\t\t}\n\t\t\treturn deleted;\n\t\t},\n\t\townKeys(target) {\n\t\t\tif (nest === false) { return Reflect.ownKeys(target); }\n\t\t\tmarkRead(target, true);\n\t\t\treturn Reflect.ownKeys(target);\n\t\t},\n\t\thas(target, prop) {\n\t\t\tif (nest === false) { return Reflect.has(target, prop); }\n\t\t\tmarkRead(target, true);\n\t\t\treturn Reflect.has(target, prop);\n\t\t},\n\t});\n\treturn proxy;\n}\n/** 获取被代理的原始值 */\nexport function recover<T>(v: T): T {\n\tif (!v) { return v; }\n\tif (!encashable(v)) { return v; }\n\tlet value = v;\n\ttry {\n\t\tgetValue = v;\n\t\tvalue = (v as any).__monitorable__recover__;\n\t} catch {}\n\tvalue = getValue;\n\tgetValue = false;\n\tif (!value) { return v; }\n\tif (typeof value === 'object') { return value; }\n\tif (typeof value === 'function') { return value; }\n\treturn v;\n}\nexport function equal(a: any, b: any): boolean {\n\treturn recover(a) === recover(b);\n}","import { safeify } from './utils';\nimport { observe, watchProp, ReadMap } from './state';\nimport { recover } from './encase';\n\nexport interface ExecResult<T> {\n\tresult: T;\n\tstop(): void;\n}\nexport interface ExecOptions {\n\tresultOnly?: boolean;\n\tpostpone?: boolean | 'priority';\n}\n/**\n * 创建可监听执行函数\n * @param fn 要监听执行的函数\n * @param cb 当监听的值发生可能改变时触发的回调函数，单如果没有被执行的函数或抛出错误，将会在每次 fn 被执行后直接执行\n */\nexport function exec<T>(\n\tfn: () => T,\n\tcb: (changed: boolean) => void,\n\tresultOnly?: false,\n): ExecResult<T>;\nexport function exec<T>(\n\tfn: () => T,\n\tcb: (changed: boolean) => void,\n\tresultOnly: true,\n): T;\nexport function exec<T>(\n\tfn: () => T,\n\tcb: (changed: boolean) => void,\n\toptions?: ExecOptions & {resultOnly?: false},\n): ExecResult<T>;\nexport function exec<T>(\n\tfn: () => T,\n\tcb: (changed: boolean) => void,\n\toptions: ExecOptions & {resultOnly: true},\n): T;\nexport function exec<T>(\n\tfn: () => T,\n\tcb: (changed: boolean) => void,\n\toptions?: boolean | ExecOptions,\n): ExecResult<T> | T;\nexport function exec<T>(\n\tfn: () => T,\n\tcb: (changed: boolean) => void,\n\toptions?: boolean | ExecOptions,\n): ExecResult<T> | T {\n\tcb = safeify(cb);\n\tlet cancelList: (() => void)[] | undefined;\n\tconst resultOnly = options === true\n\t\t|| typeof options === 'object' && options?.resultOnly;\n\tconst postpone = typeof options === 'object' && options?.postpone;\n\t/** 取消监听 */\n\tfunction cancel() {\n\t\tif (!cancelList) { return false; }\n\t\tconst list = cancelList;\n\t\tcancelList = undefined;\n\t\tlist.forEach(f => f());\n\t\treturn true;\n\t}\n\tfunction trigger() {\n\t\tif (!cancel()) { return; }\n\t\tcb(true);\n\t};\n\tconst thisRead: ReadMap = new Map();\n\tconst result = observe(fn, thisRead, { postpone });\n\tif (!thisRead.size) {\n\t\tcb(false);\n\t\tif (resultOnly) { return result; }\n\t\treturn { result, stop() {} };\n\t}\n\tcancelList = [];\n\tfor ( let [obj, props] of thisRead) {\n\t\tfor (const p of props) {\n\t\t\tcancelList.push(watchProp(recover(obj), p, trigger));\n\t\t}\n\t}\n\tif (resultOnly) { return result; }\n\treturn {\n\t\tresult,\n\t\tstop() {\n\t\t\tif (!cancel()) { return; }\n\t\t\tcb(false);\n\t\t}\n\t}\n}\n","import { safeify } from './utils';\nimport { observe, watchProp, ReadMap } from './state';\nimport { recover } from './encase';\n\nexport interface Executable<T> {\n\t(): T;\n\tstop(): void;\n}\nexport interface ExecutableOptions {\n\tpostpone?: boolean | 'priority';\n}\n/**\n * 创建可监听执行函数\n * @param fn 要监听执行的函数\n * @param cb 当监听的值发生可能改变时触发的回调函数，单如果没有被执行的函数或抛出错误，将会在每次 fn 被执行后直接执行\n */\nexport function createExecutable<T>(\n\tfn: () => T,\n\tcb: (changed: boolean) => void,\n\toptions?: ExecutableOptions,\n): Executable<T> {\n\tcb = safeify(cb);\n\tlet cancelList: (() => void)[] | undefined;\n\t/** 取消监听 */\n\tfunction cancel() {\n\t\tif (!cancelList) { return false; }\n\t\tconst list = cancelList;\n\t\tcancelList = undefined;\n\t\tlist.forEach(f => f());\n\t\treturn true;\n\t}\n\tfunction trigger() {\n\t\tif (!cancel()) { return; }\n\t\tcb(true);\n\t};\n\tfunction exec() {\n\t\tcancel();\n\t\tconst thisRead: ReadMap = new Map();\n\t\ttry {\n\t\t\treturn observe(fn, thisRead, options);\n\t\t} catch(e) {\n\t\t\tthisRead.clear();\n\t\t\tthrow e;\n\t\t} finally {\n\t\t\tif (thisRead.size) {\n\t\t\t\tcancelList = [];\n\t\t\t\tfor ( let [obj, props] of thisRead) {\n\t\t\t\t\tfor (const p of props) {\n\t\t\t\t\t\tcancelList.push(watchProp(recover(obj), p, trigger));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcb(false);\n\t\t\t}\n\t\t}\n\t}\n\texec.stop = () => {\n\t\tif (!cancel()) { return; }\n\t\tcb(false);\n\t};\n\treturn exec;\n}\n","import { safeify } from './utils';\nimport { markRead, markChange } from './state';\nimport { recover, encase } from './encase';\nimport { createExecutable } from './executable';\n\n/** 取消监听的方法 */\nexport interface CancelWatch {\n\t(): void;\n}\n/** 可监听值 */\nexport interface Value<T> {\n\t(): T;\n\t(v: T, mark?: boolean): T;\n\tvalue: T;\n\twatch(cb: WatchCallback<T, this>): CancelWatch;\n\tstop(): void;\n}\n/** 监听函数 */\nexport interface WatchCallback<T, V extends Value<T> = Value<T>> {\n\t(v: V, stopped: boolean): void;\n}\nconst values = new WeakSet<Value<any>>();\nexport function isValue(x: any): x is Value<any> {\n\treturn values.has(x);\n}\n/** 触发监听 */\ninterface Trigger {\n\t(): void;\n\t/** 是否存在监听函数 */\n\thas(): boolean;\n\t/** 停止监听 */\n\tstop(): void;\n}\nexport interface Options {\n\tproxy?: boolean;\n}\n\n\nfunction createValue<T, V extends Value<T> = Value<T>>(\n\trecover: () => T,\n\tsetValue?: (value: T, markChange: () => void) => void,\n\tstop: () => void = () => {},\n\tchange: () => void = () => {},\n): {value: V, trigger: Trigger} {\n\tfunction set(v: T, marked = false) {\n\t\tif (!setValue) { return; }\n\t\ttry {\n\t\t\tsetValue(v, () => { marked = true; });\n\t\t} finally {\n\t\t\tif (marked) {\n\t\t\t\ttrigger();\n\t\t\t}\n\t\t}\n\t}\n\tfunction get() {\n\t\tmarkRead(value, 'value');\n\t\treturn recover();\n\t}\n\tconst value: V = ((...v: [T] | [T, boolean] | []): T => {\n\t\tif (v.length) {\n\t\t\tset(v[0], v[1]);\n\t\t\treturn v[0];\n\t\t}\n\t\treturn get();\n\t}) as V;\n\tReflect.defineProperty(value, 'value', {\n\t\tget,\n\t\tset,\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n\n\tfunction watch(cb: WatchCallback<T, V>): () => void {\n\t\tif (!callbacks) { return () => {}; }\n\t\tcb = safeify(cb);\n\t\tcallbacks.push(cb);\n\t\tchange();\n\t\tlet cancelled = false;\n\t\treturn () => {\n\t\t\tif (cancelled) { return; }\n\t\t\tcancelled = true;\n\t\t\tif (!callbacks) { return; }\n\t\t\tconst index = callbacks.findIndex(a => a === cb);\n\t\t\tif (index < 0) { return; }\n\t\t\tcallbacks.splice(index, 1);\n\t\t\tchange();\n\t\t};\n\t}\n\tlet callbacks: WatchCallback<T, V>[] | undefined = [];\n\tReflect.defineProperty(value, 'watch', {\n\t\tget() { return watch; },\n\t\tset() {},\n\t\tconfigurable: true,\n\t});\n\tconst trigger = (() => {\n\t\tif (!callbacks) { return; }\n\t\tmarkChange(value, 'value');\n\t\tfor (const cb of [...callbacks]) {\n\t\t\tcb(value, false);\n\t\t}\n\t}) as Trigger;\n\ttrigger.has = () => Boolean(callbacks?.length);\n\ttrigger.stop = () => {\n\t\tif (!callbacks) { return; }\n\t\tconst list = callbacks;\n\t\tcallbacks = undefined;\n\t\tfor (const cb of [...list]) {\n\t\t\tcb(value, true);\n\t\t}\n\t};\n\tvalues.add(value);\n\tlet stopped = false;\n\tvalue.stop = () => {\n\t\tif (stopped) { return; }\n\t\tstopped = true;\n\t\tstop();\n\t\ttrigger.stop();\n\n\t};\n\treturn {value, trigger};\n}\n/**\n * 创建引用值\n * @param value 初始值\n * @param options 选项\n */\nexport function value<T>(\n\tvalue: T,\n\toptions?: Options | boolean,\n): Value<T>;\nexport function value<T>(\n\tdef: T,\n\toptions?: Options | boolean,\n): Value<T> {\n\tconst proxy = options === true || options && options.proxy;\n\tlet source: T;\n\tlet proxyValue: T;\n\tconst { value } = createValue<T>(\n\t\t() => proxyValue,\n\t\t(v, mark) => {\n\t\t\tif (proxy) { v = recover(v); }\n\t\t\tif (v === source) { return; }\n\t\t\tsource = v;\n\t\t\tproxyValue = proxy ? encase(source) : source;\n\t\t\tmark();\n\t\t},\n\t);\n\tvalue(def);\n\treturn value;\n}\n\nexport interface ComputedOptions {\n\tpostpone?: boolean | 'priority';\n\tproxy?: boolean;\n}\n/**\n * 创建计算值\n * @param getter 取值方法\n * @param options 选项\n */\nexport function computed<T>(\n\tgetter: () => T,\n\toptions?: ComputedOptions | boolean,\n): Value<T>;\n/**\n * 创建可赋值计算值\n * @param getter 取值方法\n * @param setter 复制方法\n * @param options 选项\n */\nexport function computed<T>(\n\tgetter: () => T,\n\tsetter: (value: T) => void,\n\toptions?: ComputedOptions | boolean,\n): Value<T>;\nexport function computed<T>(\n\tgetter: () => T,\n\tsetter?: ((value: T) => void) | ComputedOptions | boolean,\n\toptions?: ComputedOptions | boolean,\n): Value<T>;\nexport function computed<T>(\n\tgetter: () => T,\n\tsetter?: ((value: T) => void) | ComputedOptions | boolean,\n\toptions?: ComputedOptions | boolean,\n): Value<T> {\n\tif (typeof setter !== 'function') {\n\t\toptions = setter;\n\t\tsetter = undefined;\n\t}\n\tconst setValue = setter;\n\tconst proxy = options === true || options && options.proxy;\n\tconst postpone = typeof options === 'object' && options?.postpone;\n\tlet source: T;\n\tlet proxyValue: T;\n\tlet stopped = false;\n\tlet computed = false;\n\tlet trigger: Trigger | undefined;\n\tconst executable = createExecutable(getter, changed => {\n\t\tcomputed = !changed;\n\t\tif (changed  && trigger) {\n\t\t\ttrigger();\n\t\t}\n\t}, { postpone });\n\tfunction run() {\n\t\tcomputed = true;\n\t\ttry {\n\t\t\tsource = executable();\n\t\t\tif (proxy) { source = recover(source); }\n\t\t\tproxyValue = proxy ? encase(source) : source;\n\t\t\treturn proxyValue;\n\t\t} catch(e) {\n\t\t\tif (!stopped) {\n\t\t\t\tcomputed = false;\n\t\t\t}\n\t\t\tthrow e;\n\t\t}\n\t}\n\tlet value: Value<T>;\n\t({value, trigger} = createValue<T, Value<T>>(\n\t\t() => computed || stopped ? proxyValue : run(),\n\t\tsetValue && (v => setValue(proxy ? recover(v) : v)),\n\t\t() => {\n\t\t\tif (stopped) { return; }\n\t\t\tstopped = true;\n\t\t\tif (computed) { return; }\n\t\t\trun();\n\t\t},\n\t));\n\treturn value;\n\n}\n\nexport function merge<T, V extends Value<T> = Value<T>>(\n\tcb: WatchCallback<T, V>\n): WatchCallback<T, V> {\n\tlet oldValue: any;\n\tlet ran = false;\n\treturn (v, stopped) => {\n\t\tif (stopped) { return cb(v, stopped); }\n\t\tconst newValue = recover(v());\n\t\tif (newValue === oldValue && ran) { return; }\n\t\tran = true;\n\t\toldValue = newValue;\n\t\tcb(v, stopped);\n\t};\n}\n\ntype OffValue<V> = V extends Value<infer T> ? T : V;\n\nexport function mix<T extends object>(\n\tsource: T\n): { [K in keyof T]: OffValue<T[K]>; } {\n\tfor (const k of Reflect.ownKeys(source)) {\n\t\tconst descriptor = Reflect.getOwnPropertyDescriptor(source, k);\n\t\tif (!descriptor) { continue; }\n\t\tif (\n\t\t\t!('value' in descriptor)\n\t\t\t|| 'get' in descriptor\n\t\t\t|| 'set' in descriptor\n\t\t) { continue; }\n\t\tconst value = descriptor.value;\n\t\tif (!isValue(value)) { continue; }\n\t\tdescriptor.get = () => value.value;\n\t\tif (descriptor.writable) {\n\t\t\tdescriptor.set = v => (value as Value<any>).value = v;\n\t\t}\n\t\tdelete descriptor.value;\n\t\tdelete descriptor.writable;\n\t\tReflect.defineProperty(source, k, descriptor);\n\t}\n\treturn source as any;\n}\n"],"names":["printErrorLog","printError","info","print","undefined","console","error","encashable","v","Boolean","includes","safeify","fn","p","e","getIndexes","target","prop","String","getMapValue","map","key","def","has","get","value","set","read","markRead","indexes","Set","add","observe","options","oldRead","postpone","watchList","WeakMap","execWatch","watch","forEach","w","waitList","run","list","entries","f","priority","Map","old","wait","markChange","watchProp","cb","removed","delete","size","getValue","encase","nest","original","recover","nestLayer","Infinity","proxy","Proxy","receiver","Reflect","modified","setPrototypeOf","proto","oldProto","getPrototypeOf","defineProperty","attr","changed","desc","getOwnPropertyDescriptor","deleteProperty","deleted","ownKeys","__monitorable__recover__","equal","a","b","exec","cancelList","resultOnly","cancel","trigger","thisRead","result","stop","obj","props","push","createExecutable","clear","values","WeakSet","isValue","x","createValue","setValue","change","marked","length","enumerable","configurable","callbacks","cancelled","index","findIndex","splice","stopped","source","proxyValue","mark","computed","getter","setter","executable","merge","oldValue","ran","newValue","mix","k","descriptor","writable"],"mappings":"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"}