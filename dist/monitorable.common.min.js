/*!
 * monitorable v0.1.0-alpha.0
 * (c) 2020 Fierflame
 * @license MIT
 */
"use strict";let e;function t(t,r=!1){r||"function"!=typeof t&&void 0!==t?"function"!=typeof e?console.error(t):e(t):e=t}function r(e){return(...r)=>{try{e(...r)}catch(e){t(e,!0)}}}function n(e,t,r){if(e.has(t))return e.get(t);const n=r();return e.set(t,n),n}Object.defineProperty(exports,"__esModule",{value:!0});const o=new WeakMap;function f(e,t=0){if(r=e,!Boolean(r&&["object","function"].includes(typeof r)))return e;var r;if(o.has(e))return e;const n=!0===t?1/0:t||0;return new Proxy(e,{set(e,r,n,o){if(!1===t)return Reflect.set(e,r,n,o);const c=Reflect.has(e,r),u=Reflect.set(e,r,n,f(o));return u?(c!==Reflect.has(e,r)&&p(e,!0),u):u},get(e,r,o){if(!1===t)return Reflect.get(e,r,o);i(e,r);const c=Reflect.get(e,r,f(o));return n>0?f(c,n-1):c},setPrototypeOf(e,r){if(!1===t)return Reflect.setPrototypeOf(e,r);const n=Reflect.getPrototypeOf(e),o=Reflect.setPrototypeOf(e,r);return o&&n!==r&&p(e,!1),o},getPrototypeOf(e){if(!1===t)return Reflect.getPrototypeOf(e);i(e,!1);const r=Reflect.getPrototypeOf(e);return n>0?f(r,n-1):r},defineProperty(e,r,n){if(!1===t)return Reflect.defineProperty(e,r,n);let o=!0;if("value"in n){const t=Reflect.getOwnPropertyDescriptor(e,r);t&&"value"in t&&c(n.value)===c(t.value)&&(o=!1)}const f=Reflect.defineProperty(e,r,n);return o&&f&&p(e,r),f},getOwnPropertyDescriptor:(e,r)=>!1===t?Reflect.getOwnPropertyDescriptor(e,r):(i(e,r),Reflect.getOwnPropertyDescriptor(e,r)),deleteProperty(e,r){if(!1===t)return Reflect.deleteProperty(e,r);const n=Reflect.has(e,r),o=Reflect.deleteProperty(e,r);return n&&!Reflect.has(e,r)&&(p(e,r),p(e,!0)),o},ownKeys:e=>!1===t?Reflect.ownKeys(e):(i(e,!0),Reflect.ownKeys(e)),has:(e,r)=>!1===t?Reflect.has(e,r):(i(e,!0),Reflect.has(e,r))})}function c(e){return o.get(e)||e}let u;function i(e,t){if(!u)return;const r=n(u,e,()=>new Set);"number"==typeof t&&(t=String(t)),r.add(t)}function s(e,t=new Map,r=!1){const n=u;u=t;try{return e()}catch(e){throw r&&t.clear(),e}finally{u=n}}const l=new WeakMap;function p(e,t){var r,n;if(!e)return;if("object"!=typeof e&&"function"!=typeof e)return;if("number"==typeof t)t=String(t);else if("symbol"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return;const o=null===(r=l.get(e))||void 0===r?void 0:null===(n=r.get)||void 0===n?void 0:n.call(r,t);if(o)for(const e of[...o])e()}function a(e,t,o){if(!e)return()=>{};if("object"!=typeof e&&"function"!=typeof e)return()=>{};if("function"!=typeof o)return()=>{};if("number"==typeof t&&(t=String(t)),"symbol"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return()=>{};const f=t;e=c(e);let u=l.get(e);u||(u=new Map,l.set(e,u));const i=n(u,f,()=>new Set);o=r(o),i.add(o);let s=!1;return()=>{s||(s=!0,i.delete(o),i.size||u&&(u.delete(f),u.size||l.delete(e)))}}function y(e,t){let n;function o(){if(!n)return!1;const e=n;return n=void 0,e.forEach(e=>e()),!0}function f(){o()&&t(!0)}function c(){o();const r=new Map;try{return s(e,r,!0)}finally{if(r.size){n=[];for(let[e,t]of r)for(const r of t)n.push(a(e,r,f))}else t(!1)}}return t=r(t),c.stop=()=>{o()&&t(!1)},c}const g=new WeakSet;function d(e){return g.has(e)}function v(e,t,n=(()=>{}),o=(()=>{})){function f(e,r=!1){if(t)try{t(e,()=>{r=!0})}finally{r&&a()}}function c(){return i(u,"value"),e()}const u=(...e)=>e.length?(f(e[0],e[1]),e[0]):c();function s(e){if(!l)return()=>{};e=r(e),l.push(e),o();let t=!1;return()=>{if(t)return;if(t=!0,!l)return;const r=l.findIndex(t=>t===e);r<0||(l.splice(r,1),o())}}Reflect.defineProperty(u,"value",{get:c,set:f,enumerable:!0,configurable:!0});let l=[];Reflect.defineProperty(u,"watch",{get:()=>s,set(){},configurable:!0});const a=()=>{if(l){p(u,"value");for(const e of[...l])e(u,!1)}};a.has=()=>{var e;return Boolean(null===(e=l)||void 0===e?void 0:e.length)},a.stop=()=>{if(!l)return;const e=l;l=void 0;for(const t of[...e])t(u,!0)},g.add(u);let y=!1;return u.stop=()=>{y||(y=!0,n(),a.stop())},{value:u,trigger:a}}exports.computed=function(e,t,r){"function"!=typeof t&&(r=t,t=void 0);const n=t,o=!0===r||r&&r.proxy;let u,i,s,l=!1,p=!1;const a=y(e,e=>{p=!e,e&&s&&s()});function g(){p=!0;try{return u=a(),o&&(u=c(u)),i=o?f(u):u,i}catch(e){throw l||(p=!1),e}}let d;return({value:d,trigger:s}=v(()=>p||l?i:g(),n&&(e=>n(o?c(e):e)),()=>{l||(l=!0,p||g())})),d},exports.createExecutable=y,exports.equal=function(e,t){return c(e)===c(t)},exports.getMepValue=n,exports.getProxy=f,exports.getValue=c,exports.isValue=d,exports.markChange=p,exports.markRead=i,exports.merge=function(e){let t,r=!1;return(n,o)=>{if(o)return e(n,o);const f=c(n());f===t&&r||(r=!0,t=f,e(n,o))}},exports.mix=function(e){for(const t of Reflect.ownKeys(e)){const r=Reflect.getOwnPropertyDescriptor(e,t);if(!r)continue;if("get"in r||"set"in r||!("value"in r))continue;const n=r.value;d(n)&&(r.get=()=>n.value,r.writable&&(r.set=e=>n.value=e),delete r.value,delete r.writable,Reflect.defineProperty(e,t,r))}return e},exports.observe=s,exports.printError=t,exports.safeify=r,exports.value=function(e,t){const r=!0===t||t&&t.proxy;let n,o;const{value:u}=v(()=>o,(e,t)=>{r&&(e=c(e)),e!==n&&(n=e,o=r?f(n):n,t())});return u(e),u},exports.watchProp=a;
//# sourceMappingURL=monitorable.common.min.js.map
