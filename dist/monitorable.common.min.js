/*!
 * monitorable v0.1.0-alpha.2
 * (c) 2020 Fierflame
 * @license MIT
 */
"use strict";let e,t,r;function n(t,r=!1){r||"function"!=typeof t&&void 0!==t?"function"!=typeof e?console.error(t):e(t):e=t}function o(e){return(...t)=>{try{e(...t)}catch(e){n(e,!0)}}}function f(e,t,r){if(e.has(t))return e.get(t);const n=r();return e.set(t,n),n}function c(e){return Boolean(e&&["object","function"].includes(typeof e))}function i(e,r=0){if(!c(e))return e;const n=u(e),o=!0===r?1/0:r||0,f=new Proxy(n,{set(e,t,n,o){if(!1===r)return Reflect.set(e,t,n,o);const f=Reflect.has(e,t),c=Reflect.set(e,t,n,i(o));return c?(f!==Reflect.has(e,t)&&a(e,!0),c):c},get(e,c,u){if(t===f&&"__monitorable__recover__"===c)return void(t=n);if(!1===r)return Reflect.get(e,c,u);l(e,c);const s=Reflect.get(e,c,i(u));return o>0?i(s,o-1):s},setPrototypeOf(e,t){if(!1===r)return Reflect.setPrototypeOf(e,t);const n=Reflect.getPrototypeOf(e),o=Reflect.setPrototypeOf(e,t);return o&&n!==t&&a(e,!1),o},getPrototypeOf(e){if(!1===r)return Reflect.getPrototypeOf(e);l(e,!1);const t=Reflect.getPrototypeOf(e);return o>0?i(t,o-1):t},defineProperty(e,t,n){if(!1===r)return Reflect.defineProperty(e,t,n);let o=!0;if("value"in n){const r=Reflect.getOwnPropertyDescriptor(e,t);r&&"value"in r&&u(n.value)===u(r.value)&&(o=!1)}const f=Reflect.defineProperty(e,t,n);return o&&f&&a(e,t),f},getOwnPropertyDescriptor:(e,t)=>!1===r?Reflect.getOwnPropertyDescriptor(e,t):(l(e,t),Reflect.getOwnPropertyDescriptor(e,t)),deleteProperty(e,t){if(!1===r)return Reflect.deleteProperty(e,t);const n=Reflect.has(e,t),o=Reflect.deleteProperty(e,t);return n&&!Reflect.has(e,t)&&(a(e,t),a(e,!0)),o},ownKeys:e=>!1===r?Reflect.ownKeys(e):(l(e,!0),Reflect.ownKeys(e)),has:(e,t)=>!1===r?Reflect.has(e,t):(l(e,!0),Reflect.has(e,t))});return f}function u(e){if(!e)return e;if(!c(e))return e;let r=e;try{t=e,r=e.__monitorable__recover__}catch(e){}return r=t,t=!1,r?"object"==typeof r?r:"function"==typeof r?r:e:e}function l(e,t){if(!r)return;const n=f(r,e,()=>new Set);"number"==typeof t&&(t=String(t)),n.add(t)}function s(e,t=new Map,n=!1){const o=r;r=t;try{return e()}catch(e){throw n&&t.clear(),e}finally{r=o}}Object.defineProperty(exports,"__esModule",{value:!0});const p=new WeakMap;function a(e,t){var r,n;if(!e)return;if(!c(e))return;if("number"==typeof t)t=String(t);else if("symbol"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return;const o=null===(r=p.get(e))||void 0===r?void 0:null===(n=r.get)||void 0===n?void 0:n.call(r,t);if(o)for(const e of[...o])e()}function y(e,t,r){if(!e)return()=>{};if("object"!=typeof e&&"function"!=typeof e)return()=>{};if("function"!=typeof r)return()=>{};if("number"==typeof t&&(t=String(t)),"symbol"!=typeof t&&"string"!=typeof t&&"boolean"!=typeof t)return()=>{};const n=t;e=u(e);let c=p.get(e);c||(c=new Map,p.set(e,c));const i=f(c,n,()=>new Set);r=o(r),i.add(r);let l=!1;return()=>{l||(l=!0,i.delete(r),i.size||c&&(c.delete(n),c.size||p.delete(e)))}}function d(e,t){let r;function n(){if(!r)return!1;const e=r;return r=void 0,e.forEach(e=>e()),!0}function f(){n()&&t(!0)}function c(){n();const o=new Map;try{return s(e,o,!0)}finally{if(o.size){r=[];for(let[e,t]of o)for(const n of t)r.push(y(e,n,f))}else t(!1)}}return t=o(t),c.stop=()=>{n()&&t(!1)},c}const g=new WeakSet;function v(e){return g.has(e)}function R(e,t,r=(()=>{}),n=(()=>{})){function f(e,r=!1){if(t)try{t(e,()=>{r=!0})}finally{r&&p()}}function c(){return l(i,"value"),e()}const i=(...e)=>e.length?(f(e[0],e[1]),e[0]):c();function u(e){if(!s)return()=>{};e=o(e),s.push(e),n();let t=!1;return()=>{if(t)return;if(t=!0,!s)return;const r=s.findIndex(t=>t===e);r<0||(s.splice(r,1),n())}}Reflect.defineProperty(i,"value",{get:c,set:f,enumerable:!0,configurable:!0});let s=[];Reflect.defineProperty(i,"watch",{get:()=>u,set(){},configurable:!0});const p=()=>{if(s){a(i,"value");for(const e of[...s])e(i,!1)}};p.has=()=>{var e;return Boolean(null===(e=s)||void 0===e?void 0:e.length)},p.stop=()=>{if(!s)return;const e=s;s=void 0;for(const t of[...e])t(i,!0)},g.add(i);let y=!1;return i.stop=()=>{y||(y=!0,r(),p.stop())},{value:i,trigger:p}}exports.computed=function(e,t,r){"function"!=typeof t&&(r=t,t=void 0);const n=t,o=!0===r||r&&r.proxy;let f,c,l,s=!1,p=!1;const a=d(e,e=>{p=!e,e&&l&&l()});function y(){p=!0;try{return f=a(),o&&(f=u(f)),c=o?i(f):f,c}catch(e){throw s||(p=!1),e}}let g;return({value:g,trigger:l}=R(()=>p||s?c:y(),n&&(e=>n(o?u(e):e)),()=>{s||(s=!0,p||y())})),g},exports.createExecutable=d,exports.encase=i,exports.equal=function(e,t){return u(e)===u(t)},exports.getMapValue=f,exports.isValue=v,exports.markChange=a,exports.markRead=l,exports.merge=function(e){let t,r=!1;return(n,o)=>{if(o)return e(n,o);const f=u(n());f===t&&r||(r=!0,t=f,e(n,o))}},exports.mix=function(e){for(const t of Reflect.ownKeys(e)){const r=Reflect.getOwnPropertyDescriptor(e,t);if(!r)continue;if(!("value"in r)||"get"in r||"set"in r)continue;const n=r.value;v(n)&&(r.get=()=>n.value,r.writable&&(r.set=e=>n.value=e),delete r.value,delete r.writable,Reflect.defineProperty(e,t,r))}return e},exports.observe=s,exports.printError=n,exports.recover=u,exports.safeify=o,exports.value=function(e,t){const r=!0===t||t&&t.proxy;let n,o;const{value:f}=R(()=>o,(e,t)=>{r&&(e=u(e)),e!==n&&(n=e,o=r?i(n):n,t())});return f(e),f},exports.watchProp=y;
//# sourceMappingURL=monitorable.common.min.js.map
