{"version":3,"file":"monitorable.js","sources":["../src/utils.ts","../src/mark.ts","../src/encase.ts","../src/exec.ts","../src/monitor.ts","../src/value.ts","../src/valueify.ts","../src/asValue.ts"],"sourcesContent":["\nlet printErrorLog: undefined | ((info: any) => void);\n/** 打印错误 */\nexport function printError(info: any) {\n\tif (typeof printErrorLog === 'function') {\n\t\tprintErrorLog(info);\n\t\treturn;\n\t}\n\tconsole.error(info);\n}\n\nexport function setPrintError(p?: (info: any) => void) {\n\tprintErrorLog = typeof p === 'function' ? p : undefined;\n}\n\n/**\n * 判断对象是否可被代理\n */\nexport function encashable(v: any): v is object | Function {\n\treturn Boolean(v && ['object', 'function'].includes(typeof v));\n}\n\n\n/** 回调函数安全化处理 */\nexport function safeify<T extends any[]>(\n\tfn: (...p: T) => void\n): (...p: T) => void {\n\treturn (...p) => {\n\t\ttry {\n\t\t\tfn(...p);\n\t\t} catch(e) {\n\t\t\tprintError(e);\n\t\t}\n\t};\n}\nexport function getIndexes(\n\ttarget: any,\n\tprop: string | number | symbol | boolean,\n): [object | Function, string | boolean | symbol] | undefined {\n\tif (!target) { return undefined; }\n\tif (typeof target !== 'function' && typeof target !== 'object') {\n\t\treturn undefined;\n\t}\n\tif (typeof prop === 'number') { return [target, String(prop)]; }\n\tif (typeof prop === 'symbol') { return [target, prop]; }\n\tif (typeof prop === 'string') { return [target, prop]; }\n\tif (typeof prop === 'boolean') { return [target, prop]; }\n\treturn undefined;\n}\nexport function getMapValue<K, V>(\n\tmap: Map<K, V>,\n\tkey: K,\n\tdef: () => V,\n): V;\nexport function getMapValue<K extends object, V>(\n\tmap: WeakMap<K, V>,\n\tkey: K,\n\tdef: () => V,\n): V;\nexport function getMapValue<K, V>(\n\tmap: WeakMap<K & object, V> | Map<K, V>,\n\tkey: K,\n\tdef: () => V,\n): V {\n\tif (map.has(key as any)) {\n\t\treturn map.get(key as any)!;\n\t}\n\tconst value = def();\n\tmap.set(key as any, value);\n\treturn value;\n}\n","import { safeify, getMapValue, getIndexes } from './utils';\n\nexport type ReadMap = Map<\n\tobject | Function,\n\tMap<string | boolean | symbol, boolean>\n>;\n\n/** 已被读取的 */\nlet read: ReadMap | undefined;\n\n/**\n * 标记已读状态\n * @param obj  要标记的对象\n * @param prop 要标记的属性\n */\nexport function markRead(\n\ttarget: object | Function,\n\tprop: string | number | boolean | symbol,\n) {\n\tif (!read) { return; }\n\tconst indexes = getIndexes(target, prop);\n\tif (!indexes) { return; }\n\t[target, prop] = indexes;\n\tconst propMap = getMapValue(read, target, () => new Map());\n\tif (propMap.has(prop)) { return; }\n\tpropMap.set(prop, false);\n}\nexport interface ObserveOptions {\n\tpostpone?: boolean | 'priority';\n}\n/**\n * 监听函数的执行，并将执行过程中读取的对象值设置到 map 中\n * @param fn 要执行的含糊\n * @param map 用于存储被读取对象的 map\n */\nexport function observeRun<T>(\n\tmap: ReadMap,\n\tfn: () => T,\n\toptions?: ObserveOptions,\n): T {\n\tconst oldRead = read;\n\tread = map;\n\ttry {\n\t\tif (!options?.postpone) { return fn(); }\n\t\treturn postpone(fn, options.postpone === 'priority');\n\t} finally {\n\t\tread = oldRead;\n\t}\n}\nexport function observe<T>(\n\tmap: ReadMap,\n\tfn: () => T,\n\tpriority?: ObserveOptions,\n): T;\nexport function observe<T>(\n\tmap: ReadMap,\n\tpriority: ObserveOptions,\n\tf: () => T,\n): T;\nexport function observe<T>(\n\tmap: ReadMap,\n\tfn: (() => T) | ObserveOptions | undefined,\n\toptions?: (() => T) | ObserveOptions | undefined\n): T;\nexport function observe<T>(\n\tmap: ReadMap,\n\tfn: (() => T) | ObserveOptions | undefined,\n\toptions?: (() => T) | ObserveOptions | undefined\n): T {\n\n\tif (typeof fn === 'function') {\n\t\treturn observeRun(map, fn, options as ObserveOptions | undefined);\n\t}\n\tif (typeof options !== 'function') {\n\t\tthrow new Error('fn needs to be a function');\n\t}\n\treturn observeRun(map, options, fn);\n}\n\n\nconst watchList = new WeakMap<\n\tobject | Function,\n\tMap<string | boolean | symbol, Set<() => void>>\n>();\n\nfunction execWatch(\n\ttarget: object | Function,\n\tprop: string | boolean | symbol,\n) {\n\tconst watch = watchList.get(target)?.get(prop);\n\tif (!watch) { return; }\n\t[...watch].forEach(w => w());\n}\n\ntype MarkMap = Map<\n\tobject | Function,\n\tSet<string | boolean | symbol>\n>;\nlet waitList: MarkMap | undefined;\n\nfunction run(list: MarkMap) {\n\tfor (const [target, set] of list.entries()) {\n\t\tconst propMap = read?.get(target);\n\t\tfor (const prop of set) {\n\t\t\texecWatch(target, prop);\n\t\t\tif (propMap?.has(prop)) {\n\t\t\t\tpropMap.set(prop, true);\n\t\t\t}\n\t\t}\n\t}\n}\n\n\nfunction postponeRun<T>(f: () => T, priority?: boolean): T {\n\tconst list = !priority && waitList || new Map();\n\tconst old = waitList;\n\twaitList = list;\n\ttry {\n\t\treturn f();\n\t} finally {\n\t\twaitList = old;\n\t\tif (list !== waitList) { run(list); }\n\t}\n}\nexport function postpone<T>(priority: boolean, f: () => T): T;\nexport function postpone<T>(fn: () => T, priority?: boolean): T;\nexport function postpone<T>(\n\tfn: (() => T) | boolean | undefined,\n\tpriority?: (() => T) | boolean | undefined\n): T;\nexport function postpone<T>(\n\tfn: (() => T) | boolean | undefined,\n\tpriority?: (() => T) | boolean | undefined\n): T {\n\tif (typeof fn === 'function') {\n\t\treturn postponeRun(fn, priority as boolean | undefined);\n\t}\n\tif (typeof priority !== 'function') {\n\t\tthrow new Error('fn needs to be a function');\n\t}\n\treturn postponeRun(priority, fn);\n}\n\n\nfunction wait(\n\ttarget: object | Function,\n\tprop: string | boolean | symbol,\n) {\n\tif (!waitList) { return false; }\n\tgetMapValue(waitList, target, () => new Set()).add(prop);\n\treturn true;\n}\n\n/**\n * 标记属性的修改，同时触发监听函数\n * @param target 要标记的对象\n * @param prop   要标记的属性 特别的，false 表示原型，true 表示成员\n */\nexport function markChange(\n\ttarget: object | Function,\n\tprop: string | number | boolean | symbol,\n) {\n\n\tconst indexes = getIndexes(target, prop);\n\tif (!indexes) { return; }\n\t[target, prop] = indexes;\n\tif (wait(target, prop)) { return; }\n\texecWatch(target, prop);\n}\n\n/**\n * 观察对象属性的变化\n * @param target 要观察的对象\n * @param prop   要观察的属性名 特别的，false 表示原型，true 表示成员\n * @param fn     属性改变后触发的函数\n */\nexport function watchProp(\n\ttarget: object | Function,\n\tprop: string | number | boolean | symbol,\n\tcb: () => void,\n): () => void {\n\tif (typeof cb !== 'function') { return  () => {}; }\n\tconst indexes = getIndexes(target, prop);\n\tif (!indexes) { return () => {}; }\n\t[target, prop] = indexes;\n\n\tconst key = prop;\n\tlet map = watchList.get(target);\n\tif (!map) {\n\t\tmap = new Map();\n\t\twatchList.set(target, map);\n\t}\n\tconst list = getMapValue(map, key, () => new Set());\n\tcb = safeify(cb);\n\tlist.add(cb);\n\tlet removed = false;\n\treturn () => {\n\t\tif (removed) { return; }\n\t\tremoved = true;\n\n\t\t// 从当前列表中移除\n\t\tlist.delete(cb);\n\n\t\t// 从属性关联中删除\n\t\tif (list.size) { return; }\n\t\tif (!map) { return; }\n\t\tmap.delete(key);\n\n\t\t// 映射列表中删除\n\t\tif (map.size) { return; }\n\t\twatchList.delete(target);\n\t};\n\n}\n","import { markChange, markRead } from './mark';\n\n/**\n * 判断对象是否可被代理\n */\nfunction encashable(v: any): v is object | Function {\n\treturn Boolean(v && ['object', 'function'].includes(typeof v));\n}\n\nlet getValue: any;\n/**\n * 获取被代理对象\n * @param obj  要被代理的对象\n * @param nest 递归代理的层数\n */\nexport function encase<T>(value: T, nest: number | boolean = 0): T {\n\tif (!encashable(value)) { return value; }\n\tconst original = recover(value);\n\tconst nestLayer: number = nest === true ? Infinity : nest || 0;\n\tconst proxy = new Proxy(original, {\n\t\tset(target, prop, value, receiver) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.set(target, prop, value, receiver);\n\t\t\t}\n\t\t\tconst has = Reflect.has(target, prop);\n\t\t\tconst modified =\n\t\t\t\tReflect.set(target, prop, value, encase(receiver));\n\t\t\tif (!modified) { return modified; }\n\t\t\tif (has !== Reflect.has(target, prop)) {\n\t\t\t\tmarkChange(target, true);\n\t\t\t}\n\t\t\treturn modified;\n\t\t},\n\t\tget(target, prop, receiver) {\n\t\t\tif (getValue === proxy) {\n\t\t\t\tif (prop === '__monitorable__recover__') {\n\t\t\t\t\tgetValue = original;\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.get(target, prop, receiver);\n\t\t\t}\n\t\t\tmarkRead(target, prop);\n\t\t\tconst value = Reflect.get(target, prop, encase(receiver));\n\t\t\tif (nestLayer > 0) { return encase(value, nestLayer - 1); }\n\t\t\treturn value;\n\t\t},\n\t\tsetPrototypeOf(target, proto) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.setPrototypeOf(target, proto);\n\t\t\t}\n\t\t\tconst oldProto = Reflect.getPrototypeOf(target);\n\t\t\tconst modified = Reflect.setPrototypeOf(target, proto);\n\t\t\tif (modified && oldProto !== proto) {\n\t\t\t\tmarkChange(target, false);\n\t\t\t}\n\t\t\treturn modified;\n\t\t},\n\t\tgetPrototypeOf(target) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.getPrototypeOf(target);\n\t\t\t}\n\t\t\tmarkRead(target, false);\n\t\t\tconst value: any = Reflect.getPrototypeOf(target);\n\t\t\tif (nestLayer > 0) {\n\t\t\t\treturn encase(value, nestLayer - 1);\n\t\t\t}\n\t\t\treturn value;\n\t\t},\n\t\tdefineProperty(target, prop, attr) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.defineProperty(target, prop, attr);\n\t\t\t}\n\t\t\tlet changed = true;\n\t\t\tif ('value' in attr) {\n\t\t\t\tconst desc =\n\t\t\t\t\tReflect.getOwnPropertyDescriptor(target, prop);\n\t\t\t\tif (\n\t\t\t\t\tdesc && 'value' in desc\n\t\t\t\t\t&& recover(attr.value) === recover(desc.value)) {\n\t\t\t\t\tchanged = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst modified = Reflect.defineProperty(target, prop, attr);\n\t\t\tif (changed && modified) {\n\t\t\t\tmarkChange(target, prop);\n\t\t\t}\n\t\t\treturn modified;\n\t\t},\n\t\tgetOwnPropertyDescriptor(target, prop) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.getOwnPropertyDescriptor(target, prop);\n\t\t\t}\n\t\t\tmarkRead(target, prop);\n\t\t\treturn Reflect.getOwnPropertyDescriptor(target, prop);\n\t\t},\n\t\tdeleteProperty(target, prop) {\n\t\t\tif (nest === false) {\n\t\t\t\treturn Reflect.deleteProperty(target, prop);\n\t\t\t}\n\t\t\tconst has = Reflect.has(target, prop);\n\t\t\tconst deleted = Reflect.deleteProperty(target, prop);\n\t\t\tif (has && !Reflect.has(target, prop)) {\n\t\t\t\tmarkChange(target, prop);\n\t\t\t\tmarkChange(target, true);\n\t\t\t}\n\t\t\treturn deleted;\n\t\t},\n\t\townKeys(target) {\n\t\t\tif (nest === false) { return Reflect.ownKeys(target); }\n\t\t\tmarkRead(target, true);\n\t\t\treturn Reflect.ownKeys(target);\n\t\t},\n\t\thas(target, prop) {\n\t\t\tif (nest === false) { return Reflect.has(target, prop); }\n\t\t\tmarkRead(target, true);\n\t\t\treturn Reflect.has(target, prop);\n\t\t},\n\t});\n\treturn proxy;\n}\n/** 获取被代理的原始值 */\nexport function recover<T>(v: T): T {\n\tif (!v) { return v; }\n\tif (!encashable(v)) { return v; }\n\tlet value = v;\n\ttry {\n\t\tgetValue = v;\n\t\tvalue = (v as any).__monitorable__recover__;\n\t} catch {}\n\tvalue = getValue;\n\tgetValue = false;\n\tif (!value) { return v; }\n\tif (typeof value === 'object') { return value; }\n\tif (typeof value === 'function') { return value; }\n\treturn v;\n}\nexport function equal(a: any, b: any): boolean {\n\treturn recover(a) === recover(b);\n}\n","import { safeify } from './utils';\nimport { observe, watchProp, ReadMap, ObserveOptions } from './mark';\nimport { recover } from './encase';\n\nexport interface ExecResult<T> {\n\tresult: T;\n\tstop(): void;\n}\nexport interface ExecOptions extends ObserveOptions {\n\tresultOnly?: boolean;\n}\nfunction run<T>(\n\tcb: (changed: boolean) => void,\n\tfn: (stop: () => void) => T,\n\toptions?: ExecOptions,\n): ExecResult<T> | T {\n\tcb = safeify(cb);\n\tlet cancelList: (() => void)[] | undefined;\n\tconst postpone = options?.postpone;\n\tlet end = false;\n\t/** 取消监听 */\n\tfunction cancel() {\n\t\tif (end) { return false; }\n\t\tend = true;\n\t\tif (!cancelList) { return true; }\n\t\tconst list = cancelList;\n\t\tcancelList = undefined;\n\t\tlist.forEach(f => f());\n\t\treturn true;\n\t}\n\tfunction trigger() {\n\t\tif (!cancel()) { return; }\n\t\tcb(true);\n\t};\n\tfunction run(thisRead: ReadMap) {\n\t\tif (end) { return false; }\n\t\tif (!thisRead.size) {\n\t\t\tend = true;\n\t\t\treturn cb(false);\n\t\t}\n\t\tconst list: [\n\t\t\tobject | Function,\n\t\t\tstring | boolean | symbol,\n\t\t][] = [];\n\t\tfor ( let [obj, props] of thisRead) {\n\t\t\tfor (const [p, m] of props) {\n\t\t\t\tif (m) { return cb(true); }\n\t\t\t\tlist.push([obj, p]);\n\t\t\t}\n\t\t}\n\t\tcancelList = list.map(\n\t\t\t([obj, p]) => watchProp(recover(obj), p, trigger),\n\t\t);\n\t}\n\tfunction stop() {\n\t\tif (!cancel()) { return; }\n\t\tcb(false);\n\t};\n\tconst thisRead: ReadMap = new Map();\n\tconst result = observe(thisRead, () => fn(stop), { postpone });\n\trun(thisRead);\n\tif (options?.resultOnly) { return result; }\n\treturn { result, stop };\n}\n\n/**\n * 创建可监听执行函数\n * @param fn 要监听执行的函数\n * @param cb 当监听的值发生可能改变时触发的回调函数，单如果没有被执行的函数或抛出错误，将会在每次 fn 被执行后直接执行\n */\nexport function exec<T>(\n\tcb: (changed: boolean) => void,\n\tfn: (stop: () => void) => T,\n\toptions?: ExecOptions & {resultOnly?: false},\n): ExecResult<T>;\nexport function exec<T>(\n\tcb: (changed: boolean) => void,\n\toptions: ExecOptions & {resultOnly?: false} | undefined,\n\tfn?: (stop: () => void) => T,\n): ExecResult<T>;\n\nexport function exec<T>(\n\tcb: (changed: boolean) => void,\n\tfn: (stop: () => void) => T,\n\toptions: ExecOptions & {resultOnly: true},\n): T;\nexport function exec<T>(\n\tcb: (changed: boolean) => void,\n\toptions: ExecOptions & {resultOnly: true},\n\tfn: (stop: () => void) => T,\n): T;\n\nexport function exec<T>(\n\tcb: (changed: boolean) => void,\n\tfn: (stop: () => void) => T,\n\toptions?: ExecOptions,\n): ExecResult<T> | T;\nexport function exec<T>(\n\tcb: (changed: boolean) => void,\n\toptions: ExecOptions | undefined,\n\tfn: (stop: () => void) => T,\n): ExecResult<T> | T;\n\nexport function exec<T>(\n\tcb: (changed: boolean) => void,\n\tfn: ((stop: () => void) => T) | ExecOptions | undefined,\n\toptions?: ((stop: () => void) => T) | ExecOptions | undefined,\n): ExecResult<T> | T  {\n\tif (typeof cb !== 'function') {\n\t\tthrow new Error('cb needs to be a function');\n\t}\n\tif (typeof fn === 'function') {\n\t\treturn run(cb, fn, options as ExecOptions | undefined);\n\t}\n\tif (typeof options !== 'function') {\n\t\tthrow new Error('fn needs to be a function');\n\t}\n\treturn run(cb, options, fn);\n}\n","import { safeify } from './utils';\nimport { observe, watchProp, ReadMap, ObserveOptions } from './mark';\nimport { recover } from './encase';\n\nexport interface Monitored<T, P extends any[] = []> {\n\t(...p: P): T;\n\tstop(): void;\n}\nexport interface MonitorOptions extends ObserveOptions {}\n/**\n * 创建可监听执行函数\n * @param fn 要监听执行的函数\n * @param cb 当监听的值发生可能改变时触发的回调函数，单如果没有被执行的函数或抛出错误，将会在每次 fn 被执行后直接执行\n */\nfunction create<T, P extends any[] = []>(\n\tcb: (changed: boolean) => void,\n\tfn: (...p: P) => T,\n\toptions?: MonitorOptions,\n): Monitored<T, P> {\n\tcb = safeify(cb);\n\tlet cancelList: (() => void)[] | undefined;\n\t/** 取消监听 */\n\tfunction cancel() {\n\t\tif (!cancelList) { return false; }\n\t\tconst list = cancelList;\n\t\tcancelList = undefined;\n\t\tlist.forEach(f => f());\n\t\treturn true;\n\t}\n\tfunction trigger() {\n\t\tif (!cancel()) { return; }\n\t\tcb(true);\n\t};\n\tfunction run(thisRead: ReadMap) {\n\t\tif (!thisRead.size) {\n\t\t\treturn cb(false);\n\t\t}\n\t\tconst list: [\n\t\t\tobject | Function,\n\t\t\tstring | boolean | symbol,\n\t\t][] = [];\n\t\tfor ( let [obj, props] of thisRead) {\n\t\t\tfor (const [p, m] of props) {\n\t\t\t\tif (m) { return cb(true); }\n\t\t\t\tlist.push([obj, p]);\n\t\t\t}\n\t\t}\n\t\tcancelList = list.map(\n\t\t\t([obj, p]) => watchProp(recover(obj), p, trigger),\n\t\t);\n\t}\n\tfunction exec(...p: P) {\n\t\tcancel();\n\t\tconst thisRead: ReadMap = new Map();\n\t\tconst result = observe(thisRead, () => fn(...p), options);\n\t\trun(thisRead);\n\t\treturn result;\n\t}\n\texec.stop = () => {\n\t\tif (!cancel()) { return; }\n\t\tcb(false);\n\t};\n\treturn exec;\n}\n\n/**\n * 创建可监听执行函数\n * @param fn 要监听执行的函数\n * @param cb 当监听的值发生可能改变时触发的回调函数，单如果没有被执行的函数或抛出错误，将会在每次 fn 被执行后直接执行\n */\nexport function monitor<T, P extends any[] = []>(\n\tcb: (changed: boolean) => void,\n\tfn: (...p: P) => T,\n\toptions?: MonitorOptions,\n): Monitored<T, P>\nexport function monitor<T, P extends any[] = []>(\n\tcb: (changed: boolean) => void,\n\toptions: MonitorOptions | undefined,\n\tfn: (...p: P) => T,\n): Monitored<T, P>;\nexport function monitor<T, P extends any[] = []>(\n\tcb: (changed: boolean) => void,\n\tfn: ((...p: P) => T) | MonitorOptions | undefined,\n\toptions?: ((...p: P) => T) | MonitorOptions,\n): Monitored<T, P>;\nexport function monitor<T, P extends any[] = []>(\n\tcb: (changed: boolean) => void,\n\tfn: ((...p: P) => T) | MonitorOptions | undefined,\n\toptions?: ((...p: P) => T) | MonitorOptions,\n): Monitored<T, P> {\n\tif (typeof fn === 'function') {\n\t\treturn create(cb, fn, options as MonitorOptions | undefined);\n\t}\n\tif (typeof options !== 'function') {\n\t\tthrow new Error('fn needs to be a function');\n\t}\n\treturn create(cb, options, fn);\n}\n","import { safeify } from './utils';\nimport { markRead, markChange } from './mark';\nimport { recover, encase } from './encase';\nimport { monitor } from './monitor';\n\n/** 取消监听的方法 */\nexport interface CancelWatch {\n\t(): void;\n}\n/** 可监听值 */\nexport interface Value<T> {\n\t(): T;\n\t(v: T, mark?: boolean): T;\n\tvalue: T;\n\twatch(cb: WatchCallback<T, this>): CancelWatch;\n\tstop(): void;\n\ttoString(...p: T extends {toString(...p: infer P): string} ? P : any): string;\n\tvalueOf(): T extends {valueOf(): infer R} ? R : T;\n}\nexport type DeValue<T> = T extends Value<infer V> ? V : T;\nexport type EnValue<T> = Value<DeValue<T>>;\n/** 监听函数 */\nexport interface WatchCallback<T, V extends Value<T> = Value<T>> {\n\t(v: V, stopped: boolean): void;\n}\nconst values = new WeakSet<Value<any>>();\nexport function isValue(x: any): x is Value<any> {\n\treturn values.has(x);\n}\n/** 触发监听 */\ninterface Trigger {\n\t(): void;\n\t/** 是否存在监听函数 */\n\thas(): boolean;\n\t/** 停止监听 */\n\tstop(): void;\n}\nexport interface Options {\n\tproxy?: boolean;\n}\n\n\nfunction valueOf<T>(this: Value<T>) {\n\tconst value = this();\n\tif (value === undefined) { return value; }\n\tif (value === null) { return value; }\n\treturn (value as any).valueOf();\n}\nfunction toString<T>(this: Value<T>, ...p: any) {\n\tconst value = this();\n\tif (value === undefined) { return String(value); }\n\tif (value === null) { return String(value); }\n\tif (typeof (value as any).toString === 'function') {\n\t\treturn (value as any).toString(...p);\n\t}\n\treturn String(value);\n}\nfunction toPrimitive<T>(this: Value<T>, hint?: 'string' | 'number' | 'default') {\n\tconst value = this();\n\tif (value === undefined) { return String(value); }\n\tif (value === null) { return String(value); }\n\tif (typeof (value as any)[Symbol.toPrimitive] === 'function') {\n\t\treturn (value as any)[Symbol.toPrimitive](hint);\n\t}\n\tif (hint === 'string') {\n\t\treturn String(value);\n\t}\n\tif (hint === 'number') {\n\t\treturn Number(value);\n\t}\n\treturn value;\n}\n\nfunction createValue<T, V extends Value<T> = Value<T>>(\n\trecover: () => T,\n\tsetValue?: (value: T, markChange: () => void) => void,\n\tstop: () => void = () => {},\n\tchange: () => void = () => {},\n): {value: V, trigger: Trigger} {\n\tfunction set(v: T, marked = false) {\n\t\tif (!setValue) { return; }\n\t\ttry {\n\t\t\tsetValue(v, () => { marked = true; });\n\t\t} finally {\n\t\t\tif (marked) {\n\t\t\t\ttrigger();\n\t\t\t}\n\t\t}\n\t}\n\tfunction get() {\n\t\tmarkRead(value, 'value');\n\t\treturn recover();\n\t}\n\tconst value: V = ((...v: [T] | [T, boolean] | []): T => {\n\t\tif (v.length) {\n\t\t\tset(v[0], v[1]);\n\t\t\treturn v[0];\n\t\t}\n\t\treturn get();\n\t}) as V;\n\tReflect.defineProperty(value, 'value', {\n\t\tget,\n\t\tset,\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n\tReflect.defineProperty(value, 'valueOf', {\n\t\tvalue: valueOf,\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n\tReflect.defineProperty(value, 'toString', {\n\t\tvalue: toString,\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n\n\tReflect.defineProperty(value, Symbol.toPrimitive, {\n\t\tvalue: toPrimitive,\n\t\tenumerable: true,\n\t\tconfigurable: true,\n\t});\n\n\tfunction watch(cb: WatchCallback<T, V>): () => void {\n\t\tif (!callbacks) { return () => {}; }\n\t\tcb = safeify(cb);\n\t\tcallbacks.push(cb);\n\t\tchange();\n\t\tlet cancelled = false;\n\t\treturn () => {\n\t\t\tif (cancelled) { return; }\n\t\t\tcancelled = true;\n\t\t\tif (!callbacks) { return; }\n\t\t\tconst index = callbacks.findIndex(a => a === cb);\n\t\t\tif (index < 0) { return; }\n\t\t\tcallbacks.splice(index, 1);\n\t\t\tchange();\n\t\t};\n\t}\n\tlet callbacks: WatchCallback<T, V>[] | undefined = [];\n\tReflect.defineProperty(value, 'watch', {\n\t\tget() { return watch; },\n\t\tset() {},\n\t\tconfigurable: true,\n\t});\n\tconst trigger = (() => {\n\t\tif (!callbacks) { return; }\n\t\tmarkChange(value, 'value');\n\t\tfor (const cb of [...callbacks]) {\n\t\t\tcb(value, false);\n\t\t}\n\t}) as Trigger;\n\ttrigger.has = () => Boolean(callbacks?.length);\n\ttrigger.stop = () => {\n\t\tif (!callbacks) { return; }\n\t\tconst list = callbacks;\n\t\tcallbacks = undefined;\n\t\tfor (const cb of [...list]) {\n\t\t\tcb(value, true);\n\t\t}\n\t};\n\tvalues.add(value);\n\tlet stopped = false;\n\tvalue.stop = () => {\n\t\tif (stopped) { return; }\n\t\tstopped = true;\n\t\tstop();\n\t\ttrigger.stop();\n\n\t};\n\treturn {value, trigger};\n}\n/**\n * 创建引用值\n * @param value 初始值\n * @param options 选项\n */\nexport function value<T>(\n\tvalue: T,\n\toptions?: Options | boolean,\n): Value<T>;\nexport function value<T>(\n\tdef: T,\n\toptions?: Options | boolean,\n): Value<T> {\n\tconst proxy = options === true || options && options.proxy;\n\tlet source: T;\n\tlet proxyValue: T;\n\tconst { value } = createValue<T>(\n\t\t() => proxyValue,\n\t\t(v, mark) => {\n\t\t\tif (proxy) { v = recover(v); }\n\t\t\tif (v === source) { return; }\n\t\t\tsource = v;\n\t\t\tproxyValue = proxy ? encase(source) : source;\n\t\t\tmark();\n\t\t},\n\t);\n\tvalue(def);\n\treturn value;\n}\n\nexport interface ComputedOptions {\n\tpostpone?: boolean | 'priority';\n\tproxy?: boolean;\n}\n/**\n * 创建计算值\n * @param getter 取值方法\n * @param options 选项\n */\nexport function computed<T>(\n\tgetter: () => T,\n\toptions?: ComputedOptions | boolean,\n): Value<T>;\n/**\n * 创建可赋值计算值\n * @param getter 取值方法\n * @param setter 复制方法\n * @param options 选项\n */\nexport function computed<T>(\n\tgetter: () => T,\n\tsetter: (value: T) => void,\n\toptions?: ComputedOptions | boolean,\n): Value<T>;\nexport function computed<T>(\n\tgetter: () => T,\n\tsetter?: ((value: T) => void) | ComputedOptions | boolean,\n\toptions?: ComputedOptions | boolean,\n): Value<T>;\nexport function computed<T>(\n\tgetter: () => T,\n\tsetter?: ((value: T) => void) | ComputedOptions | boolean,\n\toptions?: ComputedOptions | boolean,\n): Value<T> {\n\tif (typeof setter !== 'function') {\n\t\toptions = setter;\n\t\tsetter = undefined;\n\t}\n\tconst setValue = setter;\n\tconst proxy = options === true || options && options.proxy;\n\tconst postpone = typeof options === 'object' && options?.postpone;\n\tlet source: T;\n\tlet proxyValue: T;\n\tlet stopped = false;\n\tlet computed = false;\n\tlet trigger: Trigger | undefined;\n\tconst executable = monitor(changed => {\n\t\tcomputed = !changed;\n\t\tif (changed  && trigger) {\n\t\t\ttrigger();\n\t\t}\n\t}, getter, { postpone });\n\tfunction run() {\n\t\tcomputed = true;\n\t\ttry {\n\t\t\tsource = executable();\n\t\t\tif (proxy) { source = recover(source); }\n\t\t\tproxyValue = proxy ? encase(source) : source;\n\t\t\treturn proxyValue;\n\t\t} catch(e) {\n\t\t\tif (!stopped) {\n\t\t\t\tcomputed = false;\n\t\t\t}\n\t\t\tthrow e;\n\t\t}\n\t}\n\tlet value: Value<T>;\n\t({value, trigger} = createValue<T, Value<T>>(\n\t\t() => computed || stopped ? proxyValue : run(),\n\t\tsetValue && (v => setValue(proxy ? recover(v) : v)),\n\t\t() => {\n\t\t\tif (stopped) { return; }\n\t\t\tstopped = true;\n\t\t\tif (computed) { return; }\n\t\t\trun();\n\t\t},\n\t));\n\treturn value;\n\n}\n\nexport function merge<T, V extends Value<T> = Value<T>>(\n\tcb: WatchCallback<T, V>\n): WatchCallback<T, V> {\n\tlet oldValue: any;\n\tlet ran = false;\n\treturn (v, stopped) => {\n\t\tif (stopped) { return cb(v, stopped); }\n\t\tconst newValue = recover(v());\n\t\tif (newValue === oldValue && ran) { return; }\n\t\tran = true;\n\t\toldValue = newValue;\n\t\tcb(v, stopped);\n\t};\n}\n\ntype OffValue<V> = V extends Value<infer T> ? T : V;\n\nexport function mix<T extends object>(\n\tsource: T\n): { [K in keyof T]: OffValue<T[K]>; } {\n\tfor (const k of Reflect.ownKeys(source)) {\n\t\tconst descriptor = Reflect.getOwnPropertyDescriptor(source, k);\n\t\tif (!descriptor) { continue; }\n\t\tif (\n\t\t\t!('value' in descriptor)\n\t\t\t|| 'get' in descriptor\n\t\t\t|| 'set' in descriptor\n\t\t) { continue; }\n\t\tconst value = descriptor.value;\n\t\tif (!isValue(value)) { continue; }\n\t\tdescriptor.get = () => value.value;\n\t\tif (descriptor.writable) {\n\t\t\tdescriptor.set = v => (value as Value<any>).value = v;\n\t\t}\n\t\tdelete descriptor.value;\n\t\tdelete descriptor.writable;\n\t\tReflect.defineProperty(source, k, descriptor);\n\t}\n\treturn source as any;\n}\n","\nimport { DeValue, Value, value, computed, isValue } from './value';\nexport interface Valueify<T> {\n\t<K extends keyof T>(\n\t\tkey: K,\n\t\tdef?: Value<DeValue<T[K]> | undefined>,\n\t\tset?: (value: DeValue<T[K]>, setted: boolean) => void\n\t): Value<DeValue<T[K]> | undefined>\n}\n\nfunction createValue<T, K extends keyof T>(\n\tprops: T,\n\tkey: K,\n\tdef: Value<DeValue<T[K]> | undefined> = value(undefined),\n\tset?: (value: DeValue<T[K]>, setted: boolean) => void,\n): Value<DeValue<T[K]> | undefined> {\n\tfunction setValue(value: DeValue<T[K]>, setted: boolean): void {\n\t\tif (!set) { return; }\n\t\tset(value, setted);\n\t}\n\treturn computed(() => {\n\t\tif (!(key in props)) { return def(); }\n\t\tconst p = props[key];\n\t\treturn isValue(p) ? p() : p;\n\t}, v => {\n\t\tif (!(key in props)) {\n\t\t\tdef(v);\n\t\t\tsetValue(v, false);\n\t\t\treturn;\n\t\t}\n\t\tconst p = props[key];\n\t\tif (isValue(p)) {\n\t\t\tp(v);\n\t\t\tsetValue(v, true);\n\t\t\treturn;\n\t\t}\n\t\tsetValue(v, false);\n\t});\n}\nexport function valueify<T>(props: T): Valueify<T>;\nexport function valueify<T, K extends keyof T>(\n\tprops: T,\n\tkey: K,\n\tdef?: Value<DeValue<T[K]> | undefined>,\n\tset?: (value: DeValue<T[K]>, setted: boolean) => void,\n): Value<DeValue<T[K]> | undefined>;\nexport function valueify<T, K extends keyof T>(\n\tprops: T,\n\tkey?: K,\n\tdef?: Value<DeValue<T[K]> | undefined>,\n\tset?: (value: DeValue<T[K]>, setted: boolean) => void\n): Valueify<T> | Value<DeValue<T[K]> | undefined> {\n\tif (arguments.length >= 2) {\n\t\treturn createValue(props, key!, def, set);\n\t}\n\treturn (k, d, s) => createValue(props, k, d, s);\n}\n","\nimport { computed, isValue, EnValue } from './value';\nexport interface AsValue<T> {\n\t<K extends keyof T>(key: K): EnValue<T[K]>\n}\n\nfunction createValue<T, K extends keyof T>(\n\tprops: T,\n\tkey: K,\n): EnValue<T[K]> {\n\treturn computed(() => {\n\t\tconst p = props[key];\n\t\treturn isValue(p) ? p() : p;\n\t}, v => {\n\t\tconst p = props[key];\n\t\tif (isValue(p)) {\n\t\t\tp(v);\n\t\t} else {\n\t\t\tprops[key] = v;\n\t\t}\n\t});\n}\nexport function asValue<T>(props: T): AsValue<T>;\nexport function asValue<T, K extends keyof T>(\n\tprops: T,\n\tkey: K,\n): EnValue<T[K]>;\nexport function asValue<T, K extends keyof T>(\n\tprops: T,\n\tkey?: K,\n): AsValue<T> | EnValue<T[K]> {\n\tif (arguments.length >= 2) {\n\t\treturn createValue(props, key!);\n\t}\n\treturn k => createValue(props, k);\n}\n"],"names":["printErrorLog","printError","info","console","error","setPrintError","p","undefined","encashable","v","Boolean","includes","safeify","fn","e","getIndexes","target","prop","String","getMapValue","map","key","def","has","get","value","set","read","markRead","indexes","propMap","Map","observeRun","options","oldRead","postpone","observe","Error","watchList","WeakMap","execWatch","watch","forEach","w","waitList","run","list","entries","postponeRun","f","priority","old","wait","Set","add","markChange","watchProp","cb","removed","delete","size","getValue","encase","nest","original","recover","nestLayer","Infinity","proxy","Proxy","receiver","Reflect","modified","setPrototypeOf","proto","oldProto","getPrototypeOf","defineProperty","attr","changed","desc","getOwnPropertyDescriptor","deleteProperty","deleted","ownKeys","__monitorable__recover__","equal","a","b","cancelList","end","cancel","trigger","thisRead","obj","props","m","push","stop","result","resultOnly","exec","create","monitor","values","WeakSet","isValue","x","valueOf","toString","toPrimitive","hint","Symbol","Number","createValue","setValue","change","marked","length","enumerable","configurable","callbacks","cancelled","index","findIndex","splice","stopped","source","proxyValue","mark","computed","getter","setter","executable","merge","oldValue","ran","newValue","mix","k","descriptor","writable","setted","valueify","arguments","d","s","asValue"],"mappings":"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"}